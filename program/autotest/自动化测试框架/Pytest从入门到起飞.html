<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Rspress v1.44.0">
    <title data-rh="true">Pytest 从入门到起飞 - mikigo`s docs</title><meta data-rh="true" name="description" content="mikigo`s docs"/>
  <script>{;const saved = localStorage.getItem('rspress-theme-appearance');const preferDark = window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = !saved || saved === 'auto' ? preferDark : saved === 'dark';document.documentElement.classList.toggle('dark', isDark);document.documentElement.style.colorScheme = isDark ? 'dark' : 'light';}</script><link rel="icon" href="/favicon.ico"><script defer src="/static/js/styles.8c99b0ac.js"></script><script defer src="/static/js/lib-react.a9370160.js"></script><script defer src="/static/js/lib-router.7fe45264.js"></script><script defer src="/static/js/9229.82fdf454.js"></script><script defer src="/static/js/index.0291b1de.js"></script><link href="/static/css/styles.94f08197.css" rel="stylesheet"></head>

  <body >
    <div id="root"><div class="navContainer_d18b1 rspress-nav px-6  sticky_ddfa7"><div class="container_e4235 flex justify-between items-center h-full"><div class="navBarTitle_c5f07"><a href="/index.html" class="link_a7cea flex items-center w-full h-full text-base font-semibold transition-opacity duration-300 hover:opacity-60"><div class="mr-1 min-w-8"><img src="/logo.png" alt="logo" id="logo" class="rspress-logo"/></div><span>mikigo`s docs</span></a></div><div class="flex flex-1 justify-end items-center"><div class="rightNav_a2fea"><div class="flex sm:flex-1 items-center sm:pl-4 sm:pr-2"><div class="rspress-nav-search-button navSearchButton_df1fb"><button><svg width="18" height="18" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9"></path></svg><p class="searchWord_af2c1">搜索文档</p><div style="opacity:0"><span></span><span>K</span></div></button></div><div class="mobileNavSearchButton_d85a9"><svg width="24" height="24" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9"></path></svg></div></div><div class="rspress-nav-menu menu h-14"><a href="/index.html" class="link_a7cea "><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">🏠首页</div></a><a href="/program/index.html" class="link_a7cea "><div class="rspress-nav-menu-item singleItem_c1154 activeItem_a28b5 text-sm font-medium mx-1.5 px-3 py-2 flex items-center">💻编程</div></a><a href="/blog/index.html" class="link_a7cea "><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">✍️博客</div></a><a href="/cookbook/index.html" class="link_a7cea "><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">🧑‍🍳菜谱</div></a></div><div class="flex-center flex-row"><div class="mx-2"><div class="md:mr-2 rspress-nav-appearance"><div class="p-1 border border-solid border-gray-300 text-gray-400  cursor-pointer rounded-md hover:border-gray-600 hover:text-gray-600 dark:hover:border-gray-200 dark:hover:text-gray-200 transition-all duration-300 w-7 h-7"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" class="dark:hidden" width="18" height="18" fill="currentColor"><path d="M12 18c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6m0-10c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4M12 4c-.6 0-1-.4-1-1V1c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1M12 24c-.6 0-1-.4-1-1v-2c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1M5.6 6.6c-.3 0-.5-.1-.7-.3L3.5 4.9c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.1.2-.4.3-.7.3M19.8 20.8c-.3 0-.5-.1-.7-.3l-1.4-1.4c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.2.2-.5.3-.7.3M3 13H1c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1M23 13h-2c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1M4.2 20.8c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.4.3-.7.3M18.4 6.6c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.5.3-.7.3"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" class="hidden dark:block" width="18" height="18" fill="currentColor"><path d="M12.1 22h-.9c-5.5-.5-9.5-5.4-9-10.9.4-4.8 4.2-8.6 9-9 .4 0 .8.2 1 .5s.2.8-.1 1.1c-2 2.7-1.4 6.4 1.3 8.4 2.1 1.6 5 1.6 7.1 0 .3-.2.7-.3 1.1-.1.3.2.5.6.5 1-.2 2.7-1.5 5.1-3.6 6.8-1.9 1.4-4.1 2.2-6.4 2.2M9.3 4.4c-2.9 1-5 3.6-5.2 6.8-.4 4.4 2.8 8.3 7.2 8.7 2.1.2 4.2-.4 5.8-1.8 1.1-.9 1.9-2.1 2.4-3.4-2.5.9-5.3.5-7.5-1.1-2.8-2.2-3.9-5.9-2.7-9.2"></path></svg></div></div></div><div class="social-links menu-item_e90a6 flex-center relative"><div class="flex-center h-full gap-x-4 transition-colors duration-300 md:mr-2"><a href="https://github.com/mikigo/mikigo.github.io" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_a4ad0"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12c0 5.303 3.438 9.8 8.205 11.385c.6.113.82-.258.82-.577c0-.285-.01-1.04-.015-2.04c-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729c1.205.084 1.838 1.236 1.838 1.236c1.07 1.835 2.809 1.305 3.495.998c.108-.776.417-1.305.76-1.605c-2.665-.3-5.466-1.332-5.466-5.93c0-1.31.465-2.38 1.235-3.22c-.135-.303-.54-1.523.105-3.176c0 0 1.005-.322 3.3 1.23c.96-.267 1.98-.399 3-.405c1.02.006 2.04.138 3 .405c2.28-1.552 3.285-1.23 3.285-1.23c.645 1.653.24 2.873.12 3.176c.765.84 1.23 1.91 1.23 3.22c0 4.61-2.805 5.625-5.475 5.92c.42.36.81 1.096.81 2.22c0 1.606-.015 2.896-.015 3.286c0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></div></div></a></div></div></div></div><div class="mobileNavMenu_e7045"><div class="navScreen_ec30c  rspress-nav-screen" id="navScreen"><div class="container_c935d"><div class="navMenu_b887b"><div class="navMenuItem_e7978 w-full"><a href="/index.html" class="link_a7cea "><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">🏠首页</div></a></div><div class="navMenuItem_e7978 w-full"><a href="/program/index.html" class="link_a7cea "><div class="rspress-nav-menu-item singleItem_c1154 activeItem_a28b5 text-sm font-medium mx-1.5 px-3 py-2 flex items-center">💻编程</div></a></div><div class="navMenuItem_e7978 w-full"><a href="/blog/index.html" class="link_a7cea "><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">✍️博客</div></a></div><div class="navMenuItem_e7978 w-full"><a href="/cookbook/index.html" class="link_a7cea "><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">🧑‍🍳菜谱</div></a></div></div><div class="flex-center flex-col gap-2"><div class="mt-2 navAppearance_bf893 flex justify-center"></div><div class="social-links menu-item_e90a6 flex-center relative"><div class="flex-center h-full gap-x-4 transition-colors duration-300 md:mr-2"><a href="https://github.com/mikigo/mikigo.github.io" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_a4ad0"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12c0 5.303 3.438 9.8 8.205 11.385c.6.113.82-.258.82-.577c0-.285-.01-1.04-.015-2.04c-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729c1.205.084 1.838 1.236 1.838 1.236c1.07 1.835 2.809 1.305 3.495.998c.108-.776.417-1.305.76-1.605c-2.665-.3-5.466-1.332-5.466-5.93c0-1.31.465-2.38 1.235-3.22c-.135-.303-.54-1.523.105-3.176c0 0 1.005-.322 3.3 1.23c.96-.267 1.98-.399 3-.405c1.02.006 2.04.138 3 .405c2.28-1.552 3.285-1.23 3.285-1.23c.645 1.653.24 2.873.12 3.176c.765.84 1.23 1.91 1.23 3.22c0 4.61-2.805 5.625-5.475 5.92c.42.36.81 1.096.81 2.22c0 1.606-.015 2.896-.015 3.286c0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></div></div></a></div></div></div></div></div><button aria-label="mobile hamburger" class=" rspress-mobile-hamburger navHamburger_ac64c text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="currentColor"><circle cx="8" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="24" cy="16" r="2" fill="currentColor"></circle></svg></button></div></div></div></div><section><div class="docLayout_af141 pt-0"><aside class="sidebar_dd719 rspress-sidebar "><div class="navTitleMask_fb17c"><div class="navBarTitle_c5f07"><a href="/index.html" class="link_a7cea flex items-center w-full h-full text-base font-semibold transition-opacity duration-300 hover:opacity-60"><div class="mr-1 min-w-8"><img src="/logo.png" alt="logo" id="logo" class="rspress-logo"/></div><span>mikigo`s docs</span></a></div></div><div class="rspress-scrollbar sidebarContent_da296"><nav class="pb-2"><a href="/program/index.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>章节预览</span></div></a><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">自动化测试</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:12px"><div class="rspress-sidebar-item"><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:18px"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex"><span class="flex-center" style="font-size:13px">自动化测试框架</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(90deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:1;margin-left:0"><div class="rspress-sidebar-item"><a href="/program/autotest/自动化测试框架/Pytest从入门到起飞.html" class="link_a7cea menuLink_bb039"><div class="menuItemActive_de63c mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Pytest 从入门到起飞</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/autotest/自动化测试框架/unittest—3小时入门版.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>unittest—3小时入门版</span></div></a></div></div></div></section></div><div class="rspress-sidebar-item"><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:18px"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex"><span class="flex-center" style="font-size:13px">UI自动化</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(90deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:1;margin-left:0"><div class="rspress-sidebar-item"><a href="/program/autotest/UI自动化/Appium—6小时入门版.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Appium—6小时入门版</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/autotest/UI自动化/Playwright—8小时入门版.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Playwright—8小时入门版</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/autotest/UI自动化/Selenium—8小时入门版.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Selenium—8小时入门版</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/autotest/UI自动化/智能化功能测试.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>智能化功能测试</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/autotest/UI自动化/智能化性能测试.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>智能化性能测试</span></div></a></div></div></div></section></div><div class="rspress-sidebar-item"><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:18px"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex"><span class="flex-center" style="font-size:13px">性能自动化</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(90deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:1;margin-left:0"><div class="rspress-sidebar-item"><a href="/program/autotest/性能自动化/JMeter—10小时入门版.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>JMeter—10小时入门版</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/autotest/性能自动化/Locust—2小时入门版.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Locust—2小时入门版</span></div></a></div></div></div></section></div><div class="rspress-sidebar-item"><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:18px"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex"><span class="flex-center" style="font-size:13px">接口自动化</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(90deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:1;margin-left:0"><div class="rspress-sidebar-item"><a href="/program/autotest/接口自动化/HttpRunner-2小时入门版.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>HttpRunner—2小时入门版</span></div></a></div></div></div></section></div><div class="rspress-sidebar-item"><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:18px"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex"><span class="flex-center" style="font-size:13px">自动化思想理念</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(90deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:1;margin-left:0"><div class="rspress-sidebar-item"><a href="/program/autotest/自动化思想理念/PageObjects.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>PageObjects（PO）</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/autotest/自动化思想理念/RPA测试技术.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>RPA测试技术</span></div></a></div></div></div></section></div></div></div></section><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">Python</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:12px"><div class="rspress-sidebar-item"><a href="/program/Python/Linux上如何选择用pip3还是sudopip3.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Linux 上如何选择用 pip3 还是 sudo pip3</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Python/Linux上安装Python3.9.9.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Linux 上安装 Python 3.9.9</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Python/MMDetection入门基础.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>MMDetection 入门基础</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Python/OpenCV(Python)基础—9小时入门版.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>OpenCV(Python)基础—9小时入门版</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Python/Python从进阶到高级—通俗易懂版.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Python从进阶到高级—通俗易懂版</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Python/Python包构建和发布.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Python包构建和发布</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Python/Python基础语法—8小时入门版.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Python基础语法—8小时入门版</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Python/Python最强静态代码检查&amp;格式化工具Ruff.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Python最强代码检查&amp;格式化工具Ruff</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Python/Python环境与依赖管理.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Python环境与依赖管理</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Python/Python风格指南.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Python风格指南</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Python/常用的获取随机字符串的方法.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>常用的获取随机字符串的方法</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Python/配置Python源的几种方法.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>配置 Python 源的几种方法</span></div></a></div></div></div></section><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">Linux</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:12px"><div class="rspress-sidebar-item"><a href="/program/Linux/Docker入门.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Docker入门</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Linux/FFmpeg常用命令与参数解释.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>FFmpeg常用命令与参数解释</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Linux/FTP服务搭建.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>FTP服务搭建</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Linux/KVM安装配置及使用说明.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>KVM安装配置及使用说明</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Linux/Linux上sudo免密.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Linux 上 sudo 免密</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Linux/Linux上远程桌面VNC配置.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Linux 上远程桌面 VNC 服务配置</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Linux/Linux基础.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Linux&amp;Shell基础</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Linux/NVIDIA驱动&amp;CUDA&amp;cuDNN安装.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>NVIDIA驱动&amp;CUDA&amp;cuDNN安装</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Linux/Nginx入门使用.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Nginx入门使用</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Linux/U盘新建分区和文件系统.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>U盘新建分区和文件系统</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Linux/dde-dconfig使用.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>dde-config使用</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Linux/deb安装包制作.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>deb安装包制作</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Linux/vim配置和插件选择.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>vim配置和插件使用</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Linux/配置开机自启服务.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>配置开机自启服务</span></div></a></div></div></div></section><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">Shell</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:12px"><div class="rspress-sidebar-item"><a href="/program/Shell/Shell参数传递.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Shell参数传递</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Shell/Shell变量使用.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Shell变量使用</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Shell/Shell字符串处理.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Shell字符串处理</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Shell/Shell数学运算.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Shell数学运算</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Shell/Shell编码规范错误参考手册.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Shell编码规范错误参考手册</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Shell/Shell进程控制.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Shell进程调用</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Shell/Shell风格指南.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Shell风格指南</span></div></a></div></div></div></section><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">前后端</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:12px"><div class="rspress-sidebar-item"><a href="/program/前后端/CSS基础.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>CSS 基础</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/前后端/Django基础知识.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Django基础知识</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/前后端/Django进阶技巧.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Django进阶技巧</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/前后端/FastAPI—8小时入门版.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>FastAPI—8小时入门版</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/前后端/JS基础.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>JS基础教程</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/前后端/Linux上安装Nodejs.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Linux 上安装 Nodejs</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/前后端/MySQL基础.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>MySQL基础</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/前后端/Vue基础.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Vue基础</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/前后端/Web基础.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>web基础</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/前后端/html基础.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>HTML 基础</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/前后端/测开前端学习基础分享.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>测开前端学习基础分享</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/前后端/研测平台权限管理前端设计.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>平台权限管理前端设计</span></div></a></div></div></div></section><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">Jenkins</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:12px"><div class="rspress-sidebar-item"><a href="/program/Jenkins/Jenkins环境搭建以及任务创建.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Jenkins环境搭建以及任务创建</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/Jenkins/Pipeline语法介绍.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Pipeline语法介绍</span></div></a></div></div></div></section><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">网络爬虫</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:12px"><div class="rspress-sidebar-item"><a href="/program/网络爬虫/Httpx.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Httpx</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/网络爬虫/Requests.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Requests</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/网络爬虫/Scrapy.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Scrapy</span></div></a></div></div></div></section><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">技术文档</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:12px"><div class="rspress-sidebar-item"><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:18px"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex"><span class="flex-center" style="font-size:13px">专利交底书</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:0"><div class="rspress-sidebar-item"><a href="/program/tech_doc/专利交底书/一种dock栏展示和交互方法技术交底书.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>一种dock栏展示和交互方法技术交底书</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/专利交底书/一种基于Linux系统执行自动化测试用例实现负载均衡的技术交底书.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>一种基于Linux系统执行自动化测试用例实现负载均衡的技术交底书</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/专利交底书/一种基于图像识别的桌面应用控件智能标注的交底书.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>一种基于图像识别的桌面应用控件智能标注的交底书</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/专利交底书/一种基于机器学习智能识别元素控件的UI自动化测试方法.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>一种基于机器学习智能识别元素控件的UI自动化测试方法</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/专利交底书/一种定位目标图片坐标的图像识别技术交底书.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>一种定位目标图片坐标的图像识别技术交底书</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/专利交底书/一种对使用Linux包管理器安装的Python包进行虚拟化的技术交底书.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>一种对使用Linux包管理器安装的Python包进行虚拟化的技术交底书</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/专利交底书/一种机器分离的应用响应性能自动化测试方案技术交底书.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>一种机器分离的应用响应性能自动化测试方案技术交底书</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/专利交底书/一种系统文件基于事物属性对其进行多维度多空间管理方法的交底书.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>一种系统文件基于事物属性对其进行多维度多空间管理方法的交底书</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/专利交底书/一种自动化测试用例步骤中断后恢复执行的技术交底书.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>一种自动化测试用例步骤中断后恢复执行的技术交底书</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/专利交底书/一种自动安装镜像的技术交底书.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>一种自动安装镜像的技术交底书</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/专利交底书/一种针对Linux系统异常命令的测试方法技术交底书.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>一种针对Linux系统异常命令的测试方法技术交底书</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/专利交底书/基于shell的测试框架技术交底书.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>基于shell的测试框架技术交底书</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/专利交底书/基于视频播放器外部获取播放中视频FPS的测试技术交底书.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>基于视频播放器获取播放中视频资源FPS的测试技术交底书</span></div></a></div></div></div></section></div><div class="rspress-sidebar-item"><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:18px"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex"><span class="flex-center" style="font-size:13px">技术调研</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:0"><div class="rspress-sidebar-item"><a href="/program/tech_doc/技术调研/wayland键鼠模拟工具技术调研.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Wayland键鼠模拟工具技术调研</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/技术调研/youqu3中断任务续跑功技术能调研.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>youqu3中断任务续跑功能调研</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/技术调研/《Avocado和YouQu对比》调研报告.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>Avocado和YouQu对比调研报告</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/技术调研/《可用于UOS桌面应用性能自动化工具》调研报告.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>可用于UOS桌面应用性能自动化工具的调研</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/技术调研/《命令行用例转换自动化测试》调研报告.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>命令行用例转换自动化测试调研</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/技术调研/《应用于桌面应用压力测试的模拟输入工具》调研报告.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>应用于桌面应用压力测试的模拟输入工具调研报告</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/技术调研/《获取影院播放视频FPS方法》调研报告.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>获取影院播放视频FPS方法</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/技术调研/《针对PMS用例数据检查与自动化工程CSV文件数据同步的方法》调研报告.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>针对PMS用例数据检查与自动化工程CSV文件数据同步的方法调研报告</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/技术调研/域管自动化测试技术调研.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>域管自动化测试技术调研</span></div></a></div></div></div></section></div><div class="rspress-sidebar-item"><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:18px"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex"><span class="flex-center" style="font-size:13px">根因分析</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:0"><div class="rspress-sidebar-item"><a href="/program/tech_doc/根因分析/Python调用动态库运行时报静态TLS块不能分配内存根因分析报告.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span><code>Python</code>调用动态库运行时报静态<code>TLS</code>块不能分配内存根因分析报告</span></div></a></div><div class="rspress-sidebar-item"><a href="/program/tech_doc/根因分析/rootfs进入MATE桌面后打开终端不能执行reboot指令根因分析.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>rootfs进入MATE桌面后打开终端不能执行reboot指令根因分析</span></div></a></div></div></div></section></div></div></div></section></nav></div></aside><div class="flex-1 relative min-w-0"><div class="rspress-sidebar-menu-container "><div class="rspress-sidebar-menu"><button type="button" class="flex-center mr-auto"><div class="text-md mr-2"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M4 6h24v2H4zm0 18h24v2H4zm0-12h24v2H4zm0 6h24v2H4z"></path></svg></div><span class="text-sm">Menu</span></button><button type="button" class="flex-center ml-auto"><span class="text-sm">本页目录</span><div class="text-md mr-2" style="transform:rotate(0deg);transition:transform 0.2s ease-out;margin-top:2px"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></button><div class="rspress-local-toc-container "><ul><li><a href="#一简介" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">一、简介</span></a></li><li><a href="#二安装" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">二、安装</span></a></li><li><a href="#三用例编写" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">三、用例编写</span></a></li><li><a href="#1函数式" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">1、函数式</span></a></li><li><a href="#2类式" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">2、类式</span></a></li><li><a href="#四fixture" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">四、fixture</span></a></li><li><a href="#1级别" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">1、级别</span></a></li><li><a href="#2不同的写法" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">2、不同的写法</span></a></li><li><a href="#21xunit-的写法" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:24px"><span class="rspress-toc-link-text block">2.1、XUnit 的写法</span></a></li><li><a href="#22fixture-写法" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:24px"><span class="rspress-toc-link-text block">2.2、fixture 写法</span></a></li><li><a href="#3共享" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">3、共享</span></a></li><li><a href="#31用例之间共享" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:24px"><span class="rspress-toc-link-text block">3.1、用例之间共享</span></a></li><li><a href="#32用例类之间共享" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:24px"><span class="rspress-toc-link-text block">3.2、用例类之间共享</span></a></li><li><a href="#33超级共享" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:24px"><span class="rspress-toc-link-text block">3.3、超级共享</span></a></li><li><a href="#4顺序" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">4、顺序</span></a></li><li><a href="#五断言" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">五、断言</span></a></li><li><a href="#1常规断言" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">1、常规断言</span></a></li><li><a href="#2自定义断言" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">2、自定义断言</span></a></li><li><a href="#六命令行参数" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">六、命令行参数</span></a></li><li><a href="#1-s" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">1、-s</span></a></li><li><a href="#2-v" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">2、-v</span></a></li><li><a href="#3-k" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">3、-k</span></a></li><li><a href="#4-m" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">4、-m</span></a></li><li><a href="#5--co" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">5、--co</span></a></li><li><a href="#6maxfail" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">6、maxfail</span></a></li><li><a href="#7reruns" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">7、reruns</span></a></li><li><a href="#8timeout" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">8、timeout</span></a></li><li><a href="#9自定义命令行参数" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">9、自定义命令行参数</span></a></li><li><a href="#七参数化" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">七、参数化</span></a></li><li><a href="#八hook钩子函数" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">八、Hook（钩子）函数</span></a></li><li><a href="#1hook-函数略览" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">1、hook 函数略览</span></a></li><li><a href="#2常用的-hook-函数" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">2、常用的 hook 函数</span></a></li><li><a href="#21pytest_addoption" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:24px"><span class="rspress-toc-link-text block">2.1、pytest_addoption</span></a></li><li><a href="#22pytest_configure" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:24px"><span class="rspress-toc-link-text block">2.2、pytest_configure</span></a></li><li><a href="#23pytest_sessionstart" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:24px"><span class="rspress-toc-link-text block">2.3、pytest_sessionstart</span></a></li><li><a href="#24pytest_collection_modifyitems" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:24px"><span class="rspress-toc-link-text block">2.4、pytest_collection_modifyitems</span></a></li><li><a href="#25pytest_runtest_setup" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:24px"><span class="rspress-toc-link-text block">2.5、pytest_runtest_setup</span></a></li><li><a href="#26pytest_runtest_makereport" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:24px"><span class="rspress-toc-link-text block">2.6、pytest_runtest_makereport</span></a></li><li><a href="#九测试报告" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">九、测试报告</span></a></li><li><a href="#1allure" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">1、allure</span></a></li><li><a href="#2pytest-html" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">2、pytest-html</span></a></li><li><a href="#3xml" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">3、xml</span></a></li><li><a href="#十pytest-框架核心" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">十、Pytest 框架核心</span></a></li></ul></div></div></div><div class="content_ff766 rspress-doc-container flex"><div class="flex-1 overflow-x-auto"><div class="rspress-doc"><!--$--><h1 id="pytest-从入门到起飞" class="rspress-doc-title text-3xl mb-10 leading-10 tracking-tight title_fb7eb">Pytest 从入门到起飞<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#pytest-从入门到起飞">#</a></h1>
<h2 id="一简介" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb">一、简介<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#一简介">#</a></h2>
<p class="my-4 leading-7">Pytest 是一个流行的基于 Python 的自动化测试框架，以其灵活性、可扩展性、易用性俘获了大批 Python 程序员的心。网上关于 pytest 的教程不少，但是都是零散的知识点，几乎没有很全面的教程，当初学习它的时候就苦于没有全面的教程而不得不去研读它的官方文档，看完一遍官方文档之后感觉还有些没弄明白，到京东上买了一本《pytest测试实战(Brian.Okken)》，如获至宝，应该说是当时唯一的一个讲解 Pytest 的书籍了，看完之后我有点失望，写得也太简单了，2天就看完了，还不如看官方文档呢，就这都能出书，我都能写书了，后面又回过头来看 Pytest 官方文档。</p>
<p class="my-4 leading-7">大家知道官方文档确实是最全的，能够让你全方位的掌握，但是，就是因为太详细了，有些东西对于99.9%的使用者来说，其实没必要掌握。经过长期摸索，我将我们经常使用到的、核心的内容总结成这篇教程，希望能以一种轻松、简单、令人愉悦的方式，将这些内容讲清楚。</p>
<p class="my-4 leading-7">也希望通过讲解各个模块的知识，潜移默化的让你理解 Pytest 的 Plugin 设计哲学。</p>
<h2 id="二安装" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb">二、安装<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#二安装">#</a></h2>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pip3 </span><span class="token" style="color:var(--code-token-function)">install</span><span> pytest</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">只需要这样安装一下就行了，够简单易用吧。</p>
<h2 id="三用例编写" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb">三、用例编写<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#三用例编写">#</a></h2>
<h3 id="1函数式" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">1、函数式<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#1函数式">#</a></h3>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_001</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>
</span></span><span style="display:block;padding:0 1.25rem">    
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_002</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-punctuation)">.</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">这种是函数式的用例写法，就是直接在 py 文件里面定义函数，函数里面写测试用例。</p>
<h3 id="2类式" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">2、类式<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#2类式">#</a></h3>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">TestMikigo</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_001</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_002</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-punctuation)">.</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">这种写法是基于类的用例写法，在函数里面写测试用例即可。</p>
<p class="my-4 leading-7">两种写法都是可以的，在执行的时候都能被 pytest 识别为用例。</p>
<p class="my-4 leading-7">从工程的角度，我更推荐使用基于类的用例写法，因为函数式的写法不能使用类级别的 fixture，因为它没有类。基于类的用例写法给我们提供了更加灵活的 fixture 的处理，让你在应对复杂测试场景的时候，游刃有余。</p>
<h2 id="四fixture" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb">四、fixture<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#四fixture">#</a></h2>
<p class="my-4 leading-7">fixture 翻译过来是 “夹具”，简单讲就是用例执行前后要做的操作，我们称为前置（setup）和后置（teardown）操作。用例就像夹心饼干一样被夹在中间。</p>
<p class="my-4 leading-7">Pytest 灵活性很重要的一方面就是体现在它的 fixture，那是相当的灵活。不仅支持多个级别，各个级别的写法还支持多样，还可以共享、默认调用、指定调用，很多骚操作，现在不知道没关系，看完这一章应该能有所收获。</p>
<h3 id="1级别" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">1、级别<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#1级别">#</a></h3>
<p class="my-4 leading-7">总共有四个级别：函数级别（funciton）、类级别（class）、模块级别（module）、会话级别（session）</p>
<p class="my-4 leading-7">这部分只需要理解概念，不需要纠结与具体的写法。</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">函数级别（funciton）</p>
<p class="my-4 leading-7">函数就是用例，函数级别的fixture就是在<strong class="font-semibold">每个</strong>用例执行前后的操作，即： <code>function_setup</code>  <code>test_case</code>  <code>function_teardown</code> 。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">类级别（class）</p>
<p class="my-4 leading-7">类级别就是在<strong class="font-semibold">每个</strong>用例类执行前后要执行的操作，注意，一个类只执行一次哦。</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">如果一个类里面只有一个函数，类级别相对于函数级别，就是在函数级别前后执行，即：<code>class_setup</code>  <code>function_setup</code>  <code>test_case</code>  <code>function_teardown</code>  <code>class_teardown</code> 。</p>
<p class="my-4 leading-7">你看其实就是在前面函数级别的基础之上外面加了一层，很好理解是吧。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">如果一类里面有多个函数，执行的顺序是：<code>class_setup</code>  <code>function_setup</code>  <code>test_case_001</code>  <code>function_teardown</code>    <code>function_setup</code>  <code>test_case_001</code> <code>function_teardown</code>  <code>class_teardown</code> 。</p>
<p class="my-4 leading-7">你注意看区别，中间有多个用例函数，每个函数外都夹了一个函数级别的fixture，然后类级别fixture是放在最外层的。</p>
</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">模块级别（module）</p>
<p class="my-4 leading-7">理解了前面类级别的fixture之后，相信你已经能推理出来了，模块其实可以理解成一个 py 文件，在一个 py 文件里面可以写多个类，每个类里面可以写多个函数。一层夹一层的。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">会话级别（session）</p>
<p class="my-4 leading-7">这个相对来讲有点抽象，其实就是你执行一次用例就是一次会话，当然一次会话里面可能只有一个用例，也可能包含多个用例模块、多个用例类、多个用例。</p>
</li>
</ul>
<h3 id="2不同的写法" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">2、不同的写法<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#2不同的写法">#</a></h3>
<p class="my-4 leading-7">这里骚操作就比较多了，看准了哈。</p>
<h4 id="21xunit-的写法" class="mt-8 leading-6 text-lg title_fb7eb">2.1、XUnit 的写法<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#21xunit-的写法">#</a></h4>
<p class="my-4 leading-7">熟悉 <code>unittest</code> 框架的人都知道，<code>unittest</code> 里面 <code>fixture</code> 的写法是 <code>setUp</code> 和 <code>tearDown</code>，<code>setUp_class</code> 和 <code>tearDown_class</code>，只有这一种写法，而且是固定的写法哈。</p>
<p class="my-4 leading-7"><code>Pytest</code> 是兼容 <code>unittest</code> 的，当然也支持这样写：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">from</span><span> datetime </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> datetime
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">from</span><span> time </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> sleep
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">from</span><span> unittest </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> TestCase
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">TestMikigo</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>TestCase</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">setUp</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是前置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_001</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">tearDown</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是后置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">注意是继承了 <code>unittest.TestCase</code> 的，<code>Pytest</code> 可以兼容运行的，基本操作哈。</p>
<p class="my-4 leading-7">除此之外还有一些你没见过的 <code>Xunit</code> 写法：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">from</span><span> datetime </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> datetime
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">from</span><span> time </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> sleep
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">TestMikigo</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">setup</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是前置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_001</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">teardown</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是后置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>我是前置 2022-01-24 16:17:59.267900
</span></span><span style="display:block;padding:0 1.25rem">我是用例 2022-01-24 16:18:00.269282
</span><span style="display:block;padding:0 1.25rem">我是后置 2022-01-24 16:18:01.270688</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">你看，<code>setup</code> 和 <code>teardown</code> 这种写法也是会被自动识别的。</p>
<p class="my-4 leading-7">还有这种，看准了哈：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">from</span><span> datetime </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> datetime
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">from</span><span> time </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> sleep
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">TestMikigo</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">setup_method</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是前置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_001</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">teardown_method</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是后置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>我是前置 2022-01-24 16:24:57.456212
</span></span><span style="display:block;padding:0 1.25rem">我是用例 2022-01-24 16:24:58.457273
</span><span style="display:block;padding:0 1.25rem">我是后置 2022-01-24 16:24:59.458097</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7"><code>setup_method</code> 和 <code>teardown_method</code> 也可以。</p>
<p class="my-4 leading-7">这里还要讲一下 <code>setup_method</code> 和 <code>setup_function</code> 的区别，<code>setup_function</code> 是在基于函数的用例写法时使用的，<code>setup_method</code> 是基于类的用例写法使用的，我面试别人的时候喜欢问这两个的区别，如果知道这个的，基本对本部分内容是了解的。</p>
<p class="my-4 leading-7">以上只是用例级别的，下面说下类级别的写法：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">from</span><span> datetime </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> datetime
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">from</span><span> time </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> sleep
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">TestMikigo</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">setup_class</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是类前置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">setup_method</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例前置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_001</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">teardown_method</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例后置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">teardown_class</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是类后置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>我是类前置 2022-01-24 16:31:59.411548
</span></span><span style="display:block;padding:0 1.25rem">我是用例前置 2022-01-24 16:32:00.411892
</span><span style="display:block;padding:0 1.25rem">我是用例 2022-01-24 16:32:01.413373
</span><span style="display:block;padding:0 1.25rem">我是用例后置 2022-01-24 16:32:02.414377
</span><span style="display:block;padding:0 1.25rem">我是类后置 2022-01-24 16:32:03.415521</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">直接写成 <code>setup_class</code> 就可以了，在 <code>unitest</code> 里面类级别的是需要加类方法装饰器 <code>@classmethod</code> 的，<code>pytest</code> 里面可加可不加，看你喜欢。</p>
<p class="my-4 leading-7">模块级别的就用 <code>setup_module</code>，会话级别的就用 <code>setup_session</code>，这都好理解，这里就不举例了。</p>
<h4 id="22fixture-写法" class="mt-8 leading-6 text-lg title_fb7eb">2.2、fixture 写法<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#22fixture-写法">#</a></h4>
<p class="my-4 leading-7">前面 <code>Xunit</code> 的写法已经很灵活了，但是 <code>Pytest</code> 真正厉害的是它自己特有的 fixture 写法。</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">from</span><span> datetime </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> datetime
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">from</span><span> time </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> sleep
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">import</span><span> pytest
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">TestMikigo</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@pytest</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">fixture</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>scope</span><span class="token operator">=</span><span class="token" style="color:var(--code-token-string)">&quot;function&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">do_something_before</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例前置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">yield</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例后置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_001</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> do_something_before</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">这里有几点要注意：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">fixture 必须要加<code>@pytest.fixture()</code> 装饰器；</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">scope 为 fixture 级别；</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">fixture 的函数名 <code>do_something_before</code> 可以自定义，但是不要和 <code>Xunit</code> 的函数名一样，不然就乱掉了。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">yield 之前是前置，yield 之后是后置，这里实际上是利用了生成器的原理；</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">函数名 do_something_before 需要显式的传入用例参数：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_001</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> do_something_before</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">或者使用 <code>@pytest.mark.usefixtures()</code> ，就像这样：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@pytest</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">mark</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">usefixtures</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;do_something_before&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>  </span><span class="token" style="color:var(--code-token-comment)"># 也可以放到类名前面，表示对这个类里面所有的用例都生效。</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_001</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">不过这种写法我个人不建议哈，字符串的形式属于硬编码，不好维护。</p>
</li>
</ul>
<p class="my-4 leading-7">这里要好好理解一下哈，短短的几句话，其实包含了很多内容哦。这种写法没有一个严格的定式，更多是一种模式。</p>
<h3 id="3共享" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">3、共享<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#3共享">#</a></h3>
<p class="my-4 leading-7">fixture 共享是 Pytest 的一大特点，也是它灵活性的重要体现。</p>
<h4 id="31用例之间共享" class="mt-8 leading-6 text-lg title_fb7eb">3.1、用例之间共享<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#31用例之间共享">#</a></h4>
<p class="my-4 leading-7">我们经常遇到多个用例需要用到同一个 fixture ：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">from</span><span> datetime </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> datetime
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">from</span><span> time </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> sleep
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">import</span><span> pytest
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">TestMikigo</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@pytest</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">fixture</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>scope</span><span class="token operator">=</span><span class="token" style="color:var(--code-token-string)">&quot;function&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">do_something_before</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例前置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">yield</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例后置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_001</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> do_something_before</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例001&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_002</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> do_something_before</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例002&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>我是用例前置 2022-01-24 18:36:52.039974
</span></span><span style="display:block;padding:0 1.25rem">我是用例001 2022-01-24 18:36:53.041396
</span><span style="display:block;padding:0 1.25rem">我是用例后置 2022-01-24 18:36:54.042808
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">我是用例前置 2022-01-24 18:36:54.043354
</span><span style="display:block;padding:0 1.25rem">我是用例002 2022-01-24 18:36:55.044742
</span><span style="display:block;padding:0 1.25rem">我是用例后置 2022-01-24 18:36:56.046134</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">你看，我们只定义了一个 fixture，然后将它的函数名 do_something_before 分别都传给了两个用例，这样它就对两个用例都生效了。</p>
<p class="my-4 leading-7">那有同学要问了，我如果有很多的用例，每个用例都要传入参数，好麻烦嘞，有没有更妙的写法？</p>
<p class="my-4 leading-7">当然有：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">from</span><span> datetime </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> datetime
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">from</span><span> time </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> sleep
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">import</span><span> pytest
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">TestMikigo</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@pytest</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">fixture</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>scope</span><span class="token operator">=</span><span class="token" style="color:var(--code-token-string)">&quot;function&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>autouse</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">do_something_before</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例前置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">yield</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例后置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_001</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例001&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_002</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例002&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7"><code>@pytest.fixture</code> 里面有个参数 <code>autouse</code> ，就是自动使用，默认是 <code>False</code>，我们传 <code>True</code> 就表示对当前作用域下的所有用例都生效。这个 “作用域” 要看这个 fixture 做处的位置，比如例子中，fixture 是在类里面，它就对这个类中的所有用例都生效，如果你把它放到模块里面，它对这个模块里的所有用例都生效。</p>
<p class="my-4 leading-7"><code>autouse</code> 一定要慎用，处理不好的话会引起执行逻辑的混乱，就是你会发现有些用例莫名奇妙，不知道在执行什么，可能就是有其他没注意到的 fixture 生效了。</p>
<h4 id="32用例类之间共享" class="mt-8 leading-6 text-lg title_fb7eb">3.2、用例类之间共享<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#32用例类之间共享">#</a></h4>
<p class="my-4 leading-7">前面的例子都是将 fixture 放在类里面，这样只能对这一个类里面的用例生效，要实现用例类之间共享，就不能写在某一个类的里面了：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">from</span><span> datetime </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> datetime
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">from</span><span> time </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> sleep
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">import</span><span> pytest
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@pytest</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">fixture</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>scope</span><span class="token operator">=</span><span class="token" style="color:var(--code-token-string)">&quot;function&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> autouse</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">do_something_before</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例前置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">yield</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例后置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">TestMikigo001</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_TestMikigo001_001</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例TestMikigo002001&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">TestMikigo002</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_TestMikigo001_001</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是TestMikigo002用例001&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">我们将 fixture 写在module 里面，这样就对文件里面的所有用例都生效。</p>
<h4 id="33超级共享" class="mt-8 leading-6 text-lg title_fb7eb">3.3、超级共享<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#33超级共享">#</a></h4>
<p class="my-4 leading-7">conftest.py 相当于是 Pytest 的一个本地插件库，你可以在用例的目录结构中任意位置新建一个 conftest.py 文件，然后在里面写入 fixture，这些 fixture 可以对这个 conftest.py 文件对当前目录及子目录下的所有用例生效，所以我称之为“超级共享”，而且各个目录都可以有自己的 conftest.py。</p>
<p class="my-4 leading-7">“超级共享” 不是官方术语，是我自创的哈。</p>
<p class="my-4 leading-7">咱们来新建一个 conftest.py 文件：</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>.
</span></span><span style="display:block;padding:0 1.25rem">├── conftest.py
</span><span style="display:block;padding:0 1.25rem">└── test_case_001.py</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">在 conftest.py 文件中写一个 fixture：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">import</span><span> pytest
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@pytest</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">fixture</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>scope</span><span class="token operator">=</span><span class="token" style="color:var(--code-token-string)">&quot;function&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> autouse</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">do_something</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例前置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">yield</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例后置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">用例：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">TestMikigo</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_case_001</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;test case 001&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">在根目录使用 <code>pytest -s -v</code> 执行一下：</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>我是最外层用例前置 2022-02-08 16:20:39.605921
</span></span><span style="display:block;padding:0 1.25rem">test case 001
</span><span style="display:block;padding:0 1.25rem">我是最外层用例后置 2022-02-08 16:20:40.606656</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">这样当前目录下哪怕有多个用例文件，里面有成千上万条用例，执行时都会加载这条fixture，你说是不是超级共享。</p>
<h3 id="4顺序" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">4、顺序<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#4顺序">#</a></h3>
<p class="my-4 leading-7">前面讲“超级共享”提到，我们可以把 fixture 写在 conftest.py 文件里面，conftest.py 文件对当前目录及子目录下的所有用例生效，而各个目录都可以有自己的 conftest.py，用例文件里面还可以写 fixture，那写了这么多 fixture，它的执行顺序是怎样的，怎么去解除一些作用，这个问题非常重要，理不清楚的话，在实际项目中你会发现这条用例都在干嘛，它为什么执行这个。</p>
<p class="my-4 leading-7">跟上思路哈。</p>
<p class="my-4 leading-7">首先，从层级上来讲仍然是：会话级别（session）—&gt; 模块级别（module）—&gt; 类级别（class）—&gt; 函数级别（funciton）这样的执行顺序。</p>
<p class="my-4 leading-7">然后，相同层级的情况下，要看 fixture 的位置，简单讲就是：外层 fixture 先执行。</p>
<p class="my-4 leading-7">我们以 function 级别的 fixture 举例，构造一个多层级的 fixture，建议你在本地按照下面的描述自己建一个demo，不然可能需要你有比较强的结构化思维：</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>.
</span></span><span style="display:block;padding:0 1.25rem">├── cases_1
</span><span style="display:block;padding:0 1.25rem">│   ├── cases_1_1
</span><span style="display:block;padding:0 1.25rem">│   │   ├── conftest.py   # cases_1_1 目录下 conftest
</span><span style="display:block;padding:0 1.25rem">│   │   └── test_cases_1_1.py  # 用例
</span><span style="display:block;padding:0 1.25rem">│   └── conftest.py  # cases_1 目录下 conftest
</span><span style="display:block;padding:0 1.25rem">└── conftest.py  # 最外层 conftest</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">最外层 conftest：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">from</span><span> datetime </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> datetime
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">from</span><span> time </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> sleep
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">import</span><span> pytest
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@pytest</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">fixture</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>scope</span><span class="token operator">=</span><span class="token" style="color:var(--code-token-string)">&quot;function&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> autouse</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">do_something</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是最外层用例前置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">yield</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是最外层用例后置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">cases_1 目录下 conftest：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">from</span><span> datetime </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> datetime
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">from</span><span> time </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> sleep
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">import</span><span> pytest
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@pytest</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">fixture</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>scope</span><span class="token operator">=</span><span class="token" style="color:var(--code-token-string)">&quot;function&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> autouse</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">do_something_1</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是 cases_1 层用例前置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">yield</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是 cases_1 层用例后置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">cases_1_1 目录下 conftest：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">from</span><span> datetime </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> datetime
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">from</span><span> time </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> sleep
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">import</span><span> pytest
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@pytest</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">fixture</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>scope</span><span class="token operator">=</span><span class="token" style="color:var(--code-token-string)">&quot;function&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> autouse</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">do_something_1_1</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是 cases_1_1 层用例前置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">yield</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是 cases_1_1 层用例后置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">用例里面：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">from</span><span> datetime </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> datetime
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">from</span><span> time </span><span class="token" style="color:var(--code-token-keyword)">import</span><span> sleep
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">import</span><span> pytest
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@pytest</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">fixture</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>scope</span><span class="token operator">=</span><span class="token" style="color:var(--code-token-string)">&quot;function&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> autouse</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">do_something_out</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例类外面前置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">yield</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例类里外面后置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">TestMikigo</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@pytest</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">fixture</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>scope</span><span class="token operator">=</span><span class="token" style="color:var(--code-token-string)">&quot;function&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> autouse</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">do_something_in</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例类里面前置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        sleep</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">yield</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是用例类里面后置&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> datetime</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>now</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_cases_1_1</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是测试用例 1_1&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">这样我们就在不同层级写了一些 function 级别的 fixture，执行一下就可以清楚的看到。</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>我是最外层用例前置 2022-02-08 15:38:52.924602
</span></span><span style="display:block;padding:0 1.25rem">我是 cases_1 层用例前置 2022-02-08 15:38:53.925916
</span><span style="display:block;padding:0 1.25rem">我是 cases_1_1 层用例前置 2022-02-08 15:38:54.927332
</span><span style="display:block;padding:0 1.25rem">我是用例类外面前置 2022-02-08 15:38:55.928774
</span><span style="display:block;padding:0 1.25rem">我是用例类里面前置 2022-02-08 15:38:56.930258
</span><span style="display:block;padding:0 1.25rem">我是测试用例 1_1
</span><span style="display:block;padding:0 1.25rem">我是用例类里面后置 2022-02-08 15:38:57.933010
</span><span style="display:block;padding:0 1.25rem">我是用例类里外面后置 2022-02-08 15:38:57.933135
</span><span style="display:block;padding:0 1.25rem">我是 cases_1_1 层用例后置 2022-02-08 15:38:57.933211
</span><span style="display:block;padding:0 1.25rem">我是 cases_1 层用例后置 2022-02-08 15:38:57.933277
</span><span style="display:block;padding:0 1.25rem">我是最外层用例后置 2022-02-08 15:38:57.933338</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">从上到下，你仔细看之后，结论呼之欲出：<strong class="font-semibold">外层先执行</strong>。</p>
<p class="my-4 leading-7">外层 conftest 先于内层 conftest，内层 conftest 先于类外面的，类外面的先于类里面的。</p>
<p class="my-4 leading-7">所以我们在写fixture的时候一定要特别注意，Pytest 给我们提供的很灵活很方便的fixture的各种写法，特别是加了 <code>autouse=True</code> 之后，如果你搞不清楚fixture哪个先执行哪个后执行，那你最好就别用这些写法，老老实实用 Xunit 的写法，已经能满足多大部分项目需求了。</p>
<p class="my-4 leading-7">注意，以上我们写的这些fixture的函数名都是不同的，如果是相同的函数名会出现什么情况呢？</p>
<p class="my-4 leading-7">咱们把 <code>do_something_out</code> 改成 <code>do_something_in</code> ，两个 fixture 函数名都是 <code>do_something_in</code>，我们看看会发生什么。</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>我是最外层用例前置 2022-02-08 15:56:03.138015
</span></span><span style="display:block;padding:0 1.25rem">我是 cases_1 层用例前置 2022-02-08 15:56:04.138356
</span><span style="display:block;padding:0 1.25rem">我是 cases_1_1 层用例前置 2022-02-08 15:56:05.139590
</span><span style="display:block;padding:0 1.25rem">我是用例类里面前置 2022-02-08 15:56:06.140796
</span><span style="display:block;padding:0 1.25rem">我是测试用例 1_1
</span><span style="display:block;padding:0 1.25rem">我是用例类里面后置 2022-02-08 15:56:07.142623
</span><span style="display:block;padding:0 1.25rem">我是 cases_1_1 层用例后置 2022-02-08 15:56:07.142667
</span><span style="display:block;padding:0 1.25rem">我是 cases_1 层用例后置 2022-02-08 15:56:07.142694
</span><span style="display:block;padding:0 1.25rem">我是最外层用例后置 2022-02-08 15:56:07.142715</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">你看，类外面的 <code>do_something_in</code> 没有执行，说明相同函数名的 fixture，只会执行内层的。</p>
<p class="my-4 leading-7">这点知识也非常重要哈，因为在实际项目中，我们经常会遇到有些用例我不想用某些外层的 fixture，于是我们可以在内层定义一个同名的 fixture，里面写pass，相当于抵消掉了外层 fixture 的作用。</p>
<h2 id="五断言" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb">五、断言<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#五断言">#</a></h2>
<h3 id="1常规断言" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">1、常规断言<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#1常规断言">#</a></h3>
<p class="my-4 leading-7">Pytest 本身并没有提供断言的方法，而是直接使用Python自带的 assert 语句进行断言。</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_case_001</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">assert</span><span> </span><span class="token number">1</span><span> </span><span class="token operator">==</span><span> </span><span class="token number">1</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">assert 后面直接写表达式就好了，so easy!</p>
<h3 id="2自定义断言" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">2、自定义断言<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#2自定义断言">#</a></h3>
<p class="my-4 leading-7">使用 assert 断言很简单，但是抛的异常日志基本没什么参考意义，因为在断言失败的时候，只会提示你 assert 后面的表达式不成立，这不是废话吗，肯定不成立才断言失败噻，问题是我的表达式可能是一些比较复杂的封装，这里面具体什么问题就不知道了。因此，使用自定义断言会比较好。</p>
<p class="my-4 leading-7">从本质上讲，断言失败实际上都是捕获的 <code>AssertionError（断言异常）</code>，所以我们只需要定义一个自定义异常类，然后抛一个 <code>AssertionError</code> 就可以了。</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">AssertCommon</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">    
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@staticmethod</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">assert_true</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>expect</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token triple-quoted-string" style="color:var(--code-token-string)">&quot;&quot;&quot;断言为真&quot;&quot;&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">if</span><span> </span><span class="token" style="color:var(--code-token-keyword)">not</span><span> expect</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token" style="color:var(--code-token-keyword)">raise</span><span> AssertionError</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token string-interpolation" style="color:var(--code-token-string)">f&quot;&lt;</span><span class="token string-interpolation interpolation" style="color:var(--code-token-punctuation)">{</span><span class="token string-interpolation interpolation">expect</span><span class="token string-interpolation interpolation" style="color:var(--code-token-punctuation)">}</span><span class="token string-interpolation" style="color:var(--code-token-string)">&gt;不为真&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">通过给 AssertionError 传入自定义的字符串，用例失败时，我们就可以看到明确的失败信息。</p>
<h2 id="六命令行参数" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb">六、命令行参数<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#六命令行参数">#</a></h2>
<p class="my-4 leading-7">使用 Pytest 执行用例时，我们经常都是通过命令行来执行的，有同学要说了，我一般是通过编辑器里面直接就执行了；在实际项目中编写用例调试用例，使用编辑器执行用例没问题，但在 CI 集成环境下，一般是需要用命令行的。</p>
<p class="my-4 leading-7">Pytest 要想玩得溜，命令行参数必须要熟悉，Pytest 支持的参数很多，有自带的参数，插件提供的参数，还有我们自己定义的一些参数，下面就介绍在项目中常用的参数：</p>
<h3 id="1-s" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">1、-s<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#1-s">#</a></h3>
<p class="my-4 leading-7">有时候你发现在用例里面使用 print 语句，但是执行的时候却没有打印，那多半是因为你没有加这个参数。等价于 <code>--capture=no</code>，用途就是捕获 print 输出。如果你不知道 <code>capture</code> 参数也没关系，不重要。</p>
<h3 id="2-v" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">2、-v<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#2-v">#</a></h3>
<p class="my-4 leading-7">详细展示终端输出。比详细更详细使用 <code>-vv</code> ，我们当然是希望输出信息越详细越好。</p>
<h3 id="3-k" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">3、-k<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#3-k">#</a></h3>
<p class="my-4 leading-7">执行用例的时候非常有用，通过关键词来匹配用例，用例的关键词有很多，模块名、文件名、类名、函数名都是关键词，比如：</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest -k &quot;test_music&quot;</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">表示执行所有包含 <code>test_music</code> 关键词的用例。</p>
<p class="my-4 leading-7">-k 还有一点可能好多同学都不知道，它还支持逻辑表达式，比如：</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest -k &quot;test_music or test_movie&quot;</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest -k &quot;not test_music and not test_movie&quot;&quot;</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">逻辑表达是支持 <code>and/or/not</code> 的逻辑组合。</p>
<p class="my-4 leading-7">在批量支持用例时，我们通常是不需要执行全量用例的，学会精准的组装用例集对于自动化测试非常重要。</p>
<h3 id="4-m" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">4、-m<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#4-m">#</a></h3>
<p class="my-4 leading-7">我们可以给用例打上标签（mark）：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">import</span><span> pytest
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">TestMikigo</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">    
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@pytest</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">mark</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">smoke</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_case_001</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-punctuation)">.</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">使用装饰器 <code>@pytest.mark</code> 点后面加标签名，就可以给用例打标签，标签名随意指定，甚至可以用中文。</p>
<p class="my-4 leading-7">打完标签之后，批量执行用例时就可以通过标签来加载用例，用法和 -k 是一样的。</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest -m &quot;smoke or core&quot;</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<h3 id="5--co" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">5、--co<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#5--co">#</a></h3>
<p class="my-4 leading-7">这个参数全称是 <code>--collect-only</code>，表示只收集用例，不执行。</p>
<p class="my-4 leading-7">每周我需要给老板汇报目前所有用例多少条，咱总不可能在代码里面一条条去数吧，我通常会使用：</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest --co</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">直接就可以看到加载了多少条用例。</p>
<p class="my-4 leading-7">另外，有时候批量修改了一些代码，可能引起一些错误，我们可以通过执行 <code>pytest --co</code>  来快速检测一下是否存在错误，因为 Pytest 在加载用例的时候同时也会检测代码中存在的一些问题。这个也非常好用。</p>
<h3 id="6maxfail" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">6、maxfail<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#6maxfail">#</a></h3>
<p class="my-4 leading-7">配置最大失败次数，如果一次执行出现了大量的失败，多半这次测试是无效的，通过配置这个参数，我们不用等到所有用例执行完才结束，尽早结束节约时间。</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest --maxfail=int_number</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">这里的 int_number 就是最大的失败次数，你可以根据你的经验来指定一个数字。</p>
<p class="my-4 leading-7">我的方案是先获取到本次要执行的总用例数 <code>collected_cases_num</code>，然后配置一个总数的比例，如 0.5，表示只要失败次数达到了总数的一半，就可以直接结束测试。</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest --maxfail=int(collected_cases_num * 0.5)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">这样做的好处是，随着项目中用例数量的增加，我不需要去修改这个最大失败的数据，而是通过配置整体的失败比例，这样做更加合理，也更易于维护。</p>
<h3 id="7reruns" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">7、reruns<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#7reruns">#</a></h3>
<p class="my-4 leading-7">失败重跑次数，在自动化测试过程中经常会有一些不确定性，网络问题、环境问题、量子力学、地球引力等等都有可能造成用例失败，特别是 UI 自动化测试，这些情况经常发生，为了尽量排除环境问题造成的用例失败，采用失败后自动重跑是一个比较好的方案。</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest --reruns=2</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">表示失败后重跑2次，如果后面重跑用例成功了，最终的用例状态为 PASSED。</p>
<p class="my-4 leading-7">这个参数需要安装三方插件：</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>sudo pip3 install pytest-rerunfailures</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<h3 id="8timeout" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">8、timeout<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#8timeout">#</a></h3>
<p class="my-4 leading-7">用例超时在 CI 流程中非常重要，因为所有的每日构建都应该是有时长限制的，一跑就是两三天不停就不叫每日构建了，用例执行过程中可能存在一些异常情况，导致用例卡住不动，或者执行速度变慢，我们使用 <code>--timeout</code> 可以给每条用例设置一个最大的时长，如果超时没有执行完，就是强制停止用例。</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest --timeout=200</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">表示每条用例的超时时间为 200 秒，注意单位是秒哦。</p>
<p class="my-4 leading-7">这个参数需要安装三方插件：</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>sudo pip3 install pytest-timeout</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<h3 id="9自定义命令行参数" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">9、自定义命令行参数<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#9自定义命令行参数">#</a></h3>
<p class="my-4 leading-7">以上参数都是 Pytest 自带的或者三方插件给我们提供的参数，当这些参数不能满足我们的需求的时候我们就需要自定义一些命令行参数。</p>
<p class="my-4 leading-7">首先，我们需要注册命令行参数，前面讲超级共享的时候讲了 conftest.py，但是 conftest.py 能做的事情可不仅仅是写点 fixture，它可是 Pytest 的本地插件，在里面我们可以写 hook（钩子）函数，这里我们介绍其中一个 hook 函数，即实现自定义命令行参数的 hook 函数，其他的 hook 函数我们后面会介绍到。</p>
<p class="my-4 leading-7">官方说法是：注册命令行选项。实际就是自定义命令行参数。</p>
<p class="my-4 leading-7">举例：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">pytest_addoption</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>parser</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    parser</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>addoption</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7"><code>parser.addoption()</code> 里面可以传入挺多参数的，但是不是所有的都需要：</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>1、name：自定义命令行参数的名字，可以是：&quot;foo&quot;， &quot;-foo&quot; 或 &quot;--foo&quot;；
</span></span><span style="display:block;padding:0 1.25rem">2、action：在命令行中遇到此参数时要采取的基本操作类型；
</span><span style="display:block;padding:0 1.25rem">3、nargs：应该使用的命令行参数的数量；
</span><span style="display:block;padding:0 1.25rem">4、const：某些操作和nargs选择所需的常量值；
</span><span style="display:block;padding:0 1.25rem">5、default：如果参数不在命令行中，则生成的默认值。
</span><span style="display:block;padding:0 1.25rem">6、type：命令行参数应该转换为的类型；
</span><span style="display:block;padding:0 1.25rem">7、choices：参数允许值的容器；
</span><span style="display:block;padding:0 1.25rem">8、required：命令行选项是否可以省略（仅可选）；
</span><span style="display:block;padding:0 1.25rem">9、help：对参数作用的简要说明；
</span><span style="display:block;padding:0 1.25rem">10、metavar：用法消息中参数的名称；
</span><span style="display:block;padding:0 1.25rem">11、dest：要添加到 parse_args() 返回的对象中的属性的名称；</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">常用的几个参数就这几个，以下是项目实例：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">pytest_addoption</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>parser</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    parser</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>addoption</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-string)">&quot;--logLevel&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        action</span><span class="token operator">=</span><span class="token" style="color:var(--code-token-string)">&quot;store&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        default</span><span class="token operator">=</span><span class="token" style="color:var(--code-token-string)">&quot;DEBUG&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-symbol)">help</span><span class="token operator">=</span><span class="token" style="color:var(--code-token-string)">&quot;DEBUG, INFO，WARNING，ERROR, CRITICAL, 终端日志输出级别&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">用于控制日志输出的级别，CI 集成环境下我们不需要输出 DEBUG 级别的日志，我们可以这样用：</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest --logLevel=INFO</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">这样在执行用例的时候，参数就可以传递进来，那么传递进来之后，我们在哪里用？</p>
<p class="my-4 leading-7">同样是在 conftest.py 里面：</p>
<p class="my-4 leading-7">（1）通过 fixture 里面的 request 对象：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@pytest</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">fixture</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>scope</span><span class="token operator">=</span><span class="token" style="color:var(--code-token-string)">&quot;session&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">do_something</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>request</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    logLevel </span><span class="token operator">=</span><span> request</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>config</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>getoption</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;--logLevel&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">这样可以获取到，<code>request.config.getoption</code> 是固定写法，经常有同学问你咋知道可以这么用呢，在哪里可以看到，实际上可以通过给 <code>request</code> 打断点，你会看到这个对象内有哪些方法。</p>
<p class="my-4 leading-7">（2）通过 hook 函数里面的 seesion 对象：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">pytest_sessionstart</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>session</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    logLevel </span><span class="token operator">=</span><span> session</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>config</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>option</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>logLevel</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">这里的 hook 函数不一定是 <code>pytest_sessionstart</code>，好多 hook 函数都可以。</p>
<p class="my-4 leading-7">（3）通过 hook 函数里面的 item 对象：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">pytest_runtest_teardown</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>item</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    logLevel </span><span class="token operator">=</span><span> item</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>session</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>config</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>option</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>logLevel</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">（4）在用例中使用：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_xxx</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>pytestconfig</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    log_level </span><span class="token operator">=</span><span> pytestconfig</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>option</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>logLevel</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7"><code>pytestconfig</code> 是 <code>pytest</code> 提供的一个内容 <code>fixture</code> ，可以获取到所有的参数；获取参数值的方法除了 <code>pytestconfig.option.logLevel</code> 这种写法，<code>pytestconfig.getoption(&quot;logLevel&quot;)</code> 这种写法也是 ok 的。</p>
<p class="my-4 leading-7">仔细观察，获取命令行参数都在 config 这个对象里面，以上举例的不同的 hook 函数默认的参数是不同的。</p>
<h2 id="七参数化" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb">七、参数化<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#七参数化">#</a></h2>
<p class="my-4 leading-7">参数化是自动化测试里面非常重要的一个特性，特别是对于接口自动化测试，那是肯定要用到的。我看到很多网上的教程将参数化称为高级技能，通过这点能看出来，高级也不咋的哈。</p>
<p class="my-4 leading-7">Pytest 的参数化使用方法也很简单，使用装饰器：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@pytest</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">mark</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">parametrize</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;par_1&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token number">2</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_case_001</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>par_1</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-punctuation)">.</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">装饰器是固定用法 <code>@pytest.mark.parametrize</code>，记住就行了，记不住就记住两个东西，首先是在 mark 里面，然后 p 开头，最后用编辑器补全就好了。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">参数有 3 个：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">第 1 个参数是字符串类型，里面是参数的变量名称，多个变量需要用逗号分隔；</p>
<p class="my-4 leading-7">这也是最常见的用法，网上教程基本都是这样讲的，但如果你看过 Pytest 源代码这个参数类型是这样定义的： <code>argnames: Union[str, List[str], Tuple[str, ...]]</code> 说明列表和元组也可以，只要里面是字符串就行。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">第 2 个参数是一个列表，准确的讲是一个可迭代对象，一般咱们就用列表好了，如果是多个参数就是 2 维列表，列表中每个元素的个数对应变量的个数。</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@pytest</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">mark</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">.</span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">parametrize</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;par_1, par_2&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token number">2</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token number">3</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token number">4</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">test_case_001</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>par_1， par_2</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-punctuation)">.</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">这个参数虽然是可迭代对象，但你最好别使用随机工具生成（每次都是随机数），这可能影响重跑失败用例等一些功能，也最好别使用生成器放里面。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">第 3 个参数是 ids，这个参数是标记 ID 的，不传也可以，区别就是不传的话终端输出的用例标题会自动加上参数，可能好多同学没用过，不理解也没关系哈，本身用的不多。</p>
</li>
</ul>
</li>
</ul>
<p class="my-4 leading-7">用例的参数化用法就是这么简单。</p>
<p class="my-4 leading-7">Pytest 其实还支持 fixture 的参数化，这也是 fixture 相对于 Xunit 写法的其中一点优势，但在实际项目中很少用，没有太多这样的需求，这里就不讲了。</p>
<h2 id="八hook钩子函数" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb">八、Hook（钩子）函数<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#八hook钩子函数">#</a></h2>
<p class="my-4 leading-7">hook 函数相当于是 Pytest 的一些本地插件，Pytest 给我们提供了许多的 hook 函数，用于处理不同阶段的自定义行为。</p>
<p class="my-4 leading-7">有几个注意点：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">hook 函数一般不建议写在非根目录下的 conftest 插件文件里面，我们一般是写在最外层的那个 conftest 里面。</li>
<li class="[&amp;:not(:first-child)]:mt-2">hook 函数都是以 <code> pytest_</code> 开头的函数。</li>
<li class="[&amp;:not(:first-child)]:mt-2">不同的 hook 函数有它自己的功能和所属的阶段。</li>
</ul>
<h3 id="1hook-函数略览" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">1、hook 函数略览<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#1hook-函数略览">#</a></h3>
<p class="my-4 leading-7">Pytest 内置了许多的 hook 函数供我们使用，下面我们就按照阶段划分，罗列一下有哪些 hook 函数，可以大致感受一下：</p>
<p class="my-4 leading-7">引导钩子：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest_load_initial_conftests
</span></span><span style="display:block;padding:0 1.25rem">pytest_cmdline_preparse
</span><span style="display:block;padding:0 1.25rem">pytest_cmdline_parse
</span><span style="display:block;padding:0 1.25rem">pytest_cmdline_main</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">初始化钩子：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest_addoption
</span></span><span style="display:block;padding:0 1.25rem">pytest_addhooks
</span><span style="display:block;padding:0 1.25rem">pytest_configure
</span><span style="display:block;padding:0 1.25rem">pytest_unconfigure
</span><span style="display:block;padding:0 1.25rem">pytest_sessionstart
</span><span style="display:block;padding:0 1.25rem">pytest_sessionfinish
</span><span style="display:block;padding:0 1.25rem">pytest_plugin_registered</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">收集钩子：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest_collection
</span></span><span style="display:block;padding:0 1.25rem">pytest_collect_directory
</span><span style="display:block;padding:0 1.25rem">pytest_collect_file
</span><span style="display:block;padding:0 1.25rem">pytest_pycollect_makemodule
</span><span style="display:block;padding:0 1.25rem">pytest_pycollect_makeitem
</span><span style="display:block;padding:0 1.25rem">pytest_generate_tests
</span><span style="display:block;padding:0 1.25rem">pytest_make_parametrize_id
</span><span style="display:block;padding:0 1.25rem">pytest_collection_modifyitems
</span><span style="display:block;padding:0 1.25rem">pytest_collection_finish</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">测试运行（runtest）钩子：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest_runtestloop
</span></span><span style="display:block;padding:0 1.25rem">pytest_runtest_protocol
</span><span style="display:block;padding:0 1.25rem">pytest_runtest_logstart
</span><span style="display:block;padding:0 1.25rem">pytest_runtest_logfinish
</span><span style="display:block;padding:0 1.25rem">pytest_runtest_setup
</span><span style="display:block;padding:0 1.25rem">pytest_runtest_call
</span><span style="display:block;padding:0 1.25rem">pytest_runtest_teardown
</span><span style="display:block;padding:0 1.25rem">pytest_runtest_makereport
</span><span style="display:block;padding:0 1.25rem">pytest_pyfunc_call</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">报告钩子：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest_collectstart
</span></span><span style="display:block;padding:0 1.25rem">pytest_make_collect_report
</span><span style="display:block;padding:0 1.25rem">pytest_itemcollected
</span><span style="display:block;padding:0 1.25rem">pytest_collectreport
</span><span style="display:block;padding:0 1.25rem">pytest_deselected
</span><span style="display:block;padding:0 1.25rem">pytest_report_header
</span><span style="display:block;padding:0 1.25rem">pytest_report_collectionfinish
</span><span style="display:block;padding:0 1.25rem">pytest_report_teststatus 
</span><span style="display:block;padding:0 1.25rem">pytest_terminal_summary
</span><span style="display:block;padding:0 1.25rem">pytest_fixture_setup
</span><span style="display:block;padding:0 1.25rem">pytest_fixture_post_finalizer
</span><span style="display:block;padding:0 1.25rem">pytest_warning_recordedLiteral 
</span><span style="display:block;padding:0 1.25rem">pytest_runtest_logreport
</span><span style="display:block;padding:0 1.25rem">pytest_assertrepr_compare
</span><span style="display:block;padding:0 1.25rem">pytest_assertion_pass</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">调试钩子：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest_internalerror
</span></span><span style="display:block;padding:0 1.25rem">pytest_keyboard_interrupt
</span><span style="display:block;padding:0 1.25rem">pytest_exception_interact
</span><span style="display:block;padding:0 1.25rem">pytest_enter_pdb</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">这些钩子函数都是 Pytest 给我们提供的，你可以在 conftest 插件文件里面去重写函数来实现你的自定义功能。</p>
<p class="my-4 leading-7">看到这么多函数先别慌，咱不需要掌握所有的，因为很多是不常用的，也就是我开篇提到的 99% 的人都用不到的，其中经常使用到的一些比较常用的 hook 函数，将会在后续内容介绍到。</p>
<h3 id="2常用的-hook-函数" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">2、常用的 hook 函数<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#2常用的-hook-函数">#</a></h3>
<h4 id="21pytest_addoption" class="mt-8 leading-6 text-lg title_fb7eb">2.1、pytest_addoption<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#21pytest_addoption">#</a></h4>
<p class="my-4 leading-7">这个 hook 函数在前面将自定义命令行参数的时候已经用过了，它的用途就是注册命令行参数，这些值在测试运行开始时会被调用一次。</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-comment)"># conftest.py</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">pytest_addoption</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>parser</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    parser</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>addoption</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">前面有例子，这里就不多讲了，用法很简单。</p>
<p class="my-4 leading-7">它都是通过 <code>parser.addoption</code> 在定义命令行参数的。</p>
<h4 id="22pytest_configure" class="mt-8 leading-6 text-lg title_fb7eb">2.2、pytest_configure<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#22pytest_configure">#</a></h4>
<p class="my-4 leading-7">这个函数主要是用来获取命令行参数的：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-comment)"># conftest.py</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">pytest_configure</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>config</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    my_option </span><span class="token operator">=</span><span> config</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>getoption</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;--opt&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">是在执行测试执行运行，简单哈。</p>
<p class="my-4 leading-7"><code>pytest_unconfigure</code> 则是在执行测试退出之前运行。</p>
<h4 id="23pytest_sessionstart" class="mt-8 leading-6 text-lg title_fb7eb">2.3、pytest_sessionstart<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#23pytest_sessionstart">#</a></h4>
<p class="my-4 leading-7">这个函数在 session 对象创建之后，执行收集之前调用：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">pytest_sessionstart</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>session</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token triple-quoted-string" style="color:var(--code-token-string)">&quot;&quot;&quot;
</span></span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token triple-quoted-string">    :param pytest.Session session: The pytest session object.
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token triple-quoted-string">    &quot;&quot;&quot;</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">session 对象里面有很多属性，常用的：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">startdir：用例根目录的绝对路径。</li>
<li class="[&amp;:not(:first-child)]:mt-2">items：用例对象的列表。</li>
<li class="[&amp;:not(:first-child)]:mt-2">config：config对象。</li>
</ul>
<p class="my-4 leading-7">你也可以往里面动态添加一些属性。</p>
<p class="my-4 leading-7">和它对应的 <code>pytest_sessionfinish</code> 是在所有测试结束，退出之前执行。</p>
<h4 id="24pytest_collection_modifyitems" class="mt-8 leading-6 text-lg title_fb7eb">2.4、pytest_collection_modifyitems<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#24pytest_collection_modifyitems">#</a></h4>
<p class="my-4 leading-7">这个函数主要用来调整用例：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-comment)"># conftest.py</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">pytest_collection_modifyitems</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>session</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> config</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> items</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token triple-quoted-string" style="color:var(--code-token-string)">&quot;&quot;&quot;
</span></span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token triple-quoted-string">    :param pytest.Session session: The pytest session object.
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token triple-quoted-string">    :param _pytest.config.Config config: The pytest config object.
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token triple-quoted-string">    :param List[pytest.Item] items: List of item objects.
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token triple-quoted-string">    &quot;&quot;&quot;</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">session 为 Pytest 的 session 对象。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">config 为 Pytest 的 config 对象。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">items 是一个列表，其他每个元素就是一个用例对象。</p>
<p class="my-4 leading-7">item 里面有很多属性，常用的：</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>name：用例的名称
</span></span><span style="display:block;padding:0 1.25rem">nodeid：从用例根目录开始到用例文件的路径
</span><span style="display:block;padding:0 1.25rem">own_markers：用例的mark标签</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
</li>
</ul>
<p class="my-4 leading-7"><code>pytest_collection_finish</code> 则是在收集完并且修改完之后运行，它是在 <code>pytest_collection_modifyitems</code> 之后的。</p>
<h4 id="25pytest_runtest_setup" class="mt-8 leading-6 text-lg title_fb7eb">2.5、pytest_runtest_setup<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#25pytest_runtest_setup">#</a></h4>
<p class="my-4 leading-7">这个函数是在调用 setup 的时候运行：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">pytest_runtest_setup</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>item</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-punctuation)">.</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">注意是 item，不是 items，item 是用例对象。</p>
<p class="my-4 leading-7">比如，你可以在每次用例执行之前输出用例的标题：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">pytest_runtest_setup</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>item</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    logger</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>info</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>item</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>function</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>__name__</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7"><code>pytest_runtest_call</code> 和 <code>pytest_runtest_teardown</code> 分别是在用例执行过程中和用例 teardown 阶段运行，用法是一样的。</p>
<h4 id="26pytest_runtest_makereport" class="mt-8 leading-6 text-lg title_fb7eb">2.6、pytest_runtest_makereport<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#26pytest_runtest_makereport">#</a></h4>
<p class="my-4 leading-7">这个函数是用于创建测试报告的，每个测试用例的测试报告都分为 setup、call 和 teardown 三个测试阶段。如果你熟悉 allure 报告的话，应该能轻易 get 到我说的。</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">pytest_runtest_makereport</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>item</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    out </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-keyword)">yield</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    report </span><span class="token operator">=</span><span> out</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>get_result</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<h2 id="九测试报告" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb">九、测试报告<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#九测试报告">#</a></h2>
<h3 id="1allure" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">1、allure<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#1allure">#</a></h3>
<p class="my-4 leading-7">Pytest 最常用的测试报告是 allure，它是一个三方插件，安装它：</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>sudo pip3 install allure-pytest</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">使用也很简单，只需要执行时加参数 <code>--alluredir=xxx</code> 即可：</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest --alluredir=report</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">这样就能在 report 目录下生成报告，打开它你会发现 report 目录下是一堆文本文件，这咋看呢？</p>
<p class="my-4 leading-7">还没完~</p>
<p class="my-4 leading-7">你还需要安装 allure 的查看工具，你可以直接从 github上去下载最新的版本，然后安装它即可，比如我现在下来安装是这样的：</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>sudo dpkg -i allure_2.19.0-1_all.deb</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">查看报告：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">在线查看：</li>
</ul>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>allure serve report</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">生成本地 html</li>
</ul>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>allure generate report -o allure-report</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">这样在 <code>allure-report</code> 目录下会一堆文件，其中有一个 <code>index.html</code> 是报告的主文件。</p>
<p class="my-4 leading-7">使用浏览器直接打开它，你会发现没有数据！</p>
<p class="my-4 leading-7">还没完~~</p>
<p class="my-4 leading-7">使用命令打开：</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>allure open allure-report</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">不出意外浏览器会自动打开报告。</p>
<p class="my-4 leading-7">需要说明的是，allure 可不是专门为 Pytest 开发的，经过很长时间的发展，它已经进化为一个报告框架了，能支持非常多的语言及工具生成测试报告，总之这玩意儿老狠了。想深入研究的同学看这里 <a href="https://qameta.io/allure-report/" target="_blank" rel="noopener noreferrer" class="link_a7cea  link_a9ef4 inline-link_f855c">allure</a> 。</p>
<h3 id="2pytest-html" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">2、pytest-html<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#2pytest-html">#</a></h3>
<p class="my-4 leading-7">上古时期 Pytest 的“糟糠之妻”，尽管该项目是由 Pytest 官方在维护，但是社区热度不行了，主要是因为颜值不行，很少有人用，也不想过多的介绍它，走个过场吧。</p>
<p class="my-4 leading-7">安装：</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>sudo pip3 install pytest-html</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">使用：</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest </span><span class="token operator">-</span><span class="token operator">-</span><span>html</span><span class="token operator">=</span><span>report</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>html</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<h3 id="3xml" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">3、xml<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#3xml">#</a></h3>
<p class="my-4 leading-7">这是个 Pytest 自带的报告，不需要安装插件：</p>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>pytest --junit-xml=report.xml</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">我个人还是非常喜欢这种报告形式的，因为它不需要安装其他插件，而且处理报告中的数据也非常简单。</p>
<h2 id="十pytest-框架核心" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb">十、Pytest 框架核心<a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#十pytest-框架核心">#</a></h2>
<p class="my-4 leading-7">我们通常基于 Pytest 来编写搭建我们自己的测试框架，Pytest 自然就成了我们自己测试框架的核心，那么同学们有没有想过，Pytest 的核心是什么？</p>
<p class="my-4 leading-7">相信 90% 的同学没去考虑过或者没了解过~</p>
<p class="my-4 leading-7">Pluggy 就是 Pytest 的核心框架，几乎 Pytest 所有的功能都是基于 Pluggy 实现的，这是一个被极少人知道且严重低估的框架，它到底是什么玩意儿，咱们这里简单聊一聊。</p>
<p class="my-4 leading-7">Pluggy 是从 Pytest 框架中被开发者抽取出来的，因为开发者发现他们设计的这种插件化方案，完全可用在其他的项目中，因此他们总结提炼出了 Pluggy 项目；</p>
<p class="my-4 leading-7">令人直呼“厚礼谢”的是整个 Pluggy 项目加起来也就 1100 来行代码（包含注释 ），这就是 Pytest 的核心基石，就像是 Linux 系统中的 Linux 内核的作用。理解它你才能真正理解 Pytest 插件化设计哲学。</p>
<p class="my-4 leading-7">为什么说它被低估了，github 上才不到 900 的 star，真的是深藏功与名！</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">import</span><span> pluggy
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># hook 规范，用于生成一个修饰器去标记函数作为钩子函数</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>hookspec </span><span class="token operator">=</span><span> pluggy</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>HookspecMarker</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;mikigo&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span> 
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># hook 实现，用于生成一个修饰器去标记函数作为钩子函数的具体实现</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>hookimpl </span><span class="token operator">=</span><span> pluggy</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>HookimplMarker</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;mikigo&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">Mikigo</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@hookspec</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">miki</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg1</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg2</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>       </span><span class="token triple-quoted-string" style="color:var(--code-token-string)">&quot;&quot;&quot;这是一个可以定制的钩子&quot;&quot;&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">Plugin_1</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@hookimpl</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">miki</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg1</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg2</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是 Plugin_1.miki()&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">return</span><span> arg1 </span><span class="token operator">+</span><span> arg2
</span></span><span style="display:block;padding:0 1.25rem">    
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># 实例化一个插件管理器对象    </span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>pm </span><span class="token operator">=</span><span> pluggy</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>PluginManager</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;mikigo&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># 将 Mikigo 类添加进去</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>pm</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>add_hookspecs</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>Mikigo</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># 注册插件类</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>pm</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>register</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>Plugin_1</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># 通过 hook 属性访问函数</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>results </span><span class="token operator">=</span><span> pm</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>hook</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>miki</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>arg1</span><span class="token operator">=</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg2</span><span class="token operator">=</span><span class="token number">2</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>results</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>我是 Plugin_1.miki()
</span></span><span style="display:block;padding:0 1.25rem">[3]</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">你看，原来的 <code>Mikigo</code> 类里面的函数是没有执行的，而是执行了 <code>Plugin_1</code> 类里面的函数，并且获取到了返回值。</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><code>PluginManager</code> 是整个插件系统的管理器，传递一个工程名称即可进行实例化；</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><code>add_hookspecs</code> 添加一个钩子到管理器中，参数是 module 或 class 对象，底层实际是通过 <code>dir()</code> 自省函数进行遍历添加到一个 names 的容器中。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><code>register</code>  注册插件</p>
</li>
</ul>
<p class="my-4 leading-7">如果咱们还想增加一个插件呢?</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">import</span><span> pluggy
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># hook 规范，用于生成一个装饰器去标记函数作为钩子函数</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>hookspec </span><span class="token operator">=</span><span> pluggy</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>HookspecMarker</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;mikigo&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span> 
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># hook 实现，用于生成一个装饰器去标记函数作为钩子函数的具体实现</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>hookimpl </span><span class="token operator">=</span><span> pluggy</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>HookimplMarker</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;mikigo&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">Mikigo</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@hookspec</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">miki</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg1</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg2</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>       </span><span class="token" style="color:var(--code-token-string)">&quot;这是一个可以定制的钩子&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">Plugin_1</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@hookimpl</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">miki</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg1</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg2</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是 Plugin_1.miki()&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">return</span><span> arg1 </span><span class="token operator">+</span><span> arg2
</span></span><span style="display:block;padding:0 1.25rem">    
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">Plugin_2</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@hookimpl</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">miki</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg1</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg2</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是 Plugin_2.miki()&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">return</span><span> arg1 </span><span class="token operator">-</span><span> arg2
</span></span><span style="display:block;padding:0 1.25rem">    
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># 实例化一个插件管理器对象    </span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>pm </span><span class="token operator">=</span><span> pluggy</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>PluginManager</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;mikigo&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># 将 Mikigo 类添加进去</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>pm</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>add_hookspecs</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>Mikigo</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># 注册插件类</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>pm</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>register</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>Plugin_1</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>pm</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>register</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>Plugin_2</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># 通过 hook 属性访问函数</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>results </span><span class="token operator">=</span><span> pm</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>hook</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>miki</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>arg1</span><span class="token operator">=</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg2</span><span class="token operator">=</span><span class="token number">2</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>results</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>我是 Plugin_2.miki()
</span></span><span style="display:block;padding:0 1.25rem">我是 Plugin_1.miki()
</span><span style="display:block;padding:0 1.25rem">[-1, 3]</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7"><code>Plugin_2</code> 先执行，然后 <code>Plugin_1</code> 也执行了，两个插件的返回值也都放到一个列表里面了，是不是很神奇。</p>
<p class="my-4 leading-7">那如果想 <code>Plugin_1</code> 先执行，<code>Plugin_2</code> 后执行呢？</p>
<div class="language-python"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-python" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">import</span><span> pluggy
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># hook 规范，用于生成一个修饰器去标记函数作为钩子函数</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>hookspec </span><span class="token operator">=</span><span> pluggy</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>HookspecMarker</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;mikigo&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># hook 实现，用于生成一个修饰器去标记函数作为钩子函数的具体实现</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>hookimpl </span><span class="token operator">=</span><span> pluggy</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>HookimplMarker</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;mikigo&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">Mikigo</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@hookspec</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">miki</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg1</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg2</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-string)">&quot;这是一个可以定制的钩子&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">Plugin_1</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@hookimpl</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>tryfirst</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">miki</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg1</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg2</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是 Plugin_1.miki()&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">return</span><span> arg1 </span><span class="token operator">+</span><span> arg2
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">class</span><span> </span><span class="token class-name">Plugin_2</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token decorator annotation" style="color:var(--code-token-punctuation)">@hookimpl</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>trylast</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">def</span><span> </span><span class="token" style="color:var(--code-token-function)">miki</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>self</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg1</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg2</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;我是 Plugin_2.miki()&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">return</span><span> arg1 </span><span class="token operator">-</span><span> arg2
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># 实例化一个插件管理器对象</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>pm </span><span class="token operator">=</span><span> pluggy</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>PluginManager</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;mikigo&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># 将 Mikigo 类添加进去</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>pm</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>add_hookspecs</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>Mikigo</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># 注册插件类</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>pm</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>register</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>Plugin_1</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>pm</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>register</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>Plugin_2</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># 通过 hook 属性访问函数</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>results </span><span class="token operator">=</span><span> pm</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>hook</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>miki</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>arg1</span><span class="token operator">=</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> arg2</span><span class="token operator">=</span><span class="token number">2</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">print</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>results</span><span class="token" style="color:var(--code-token-punctuation)">)</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<div class="language-console"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-console" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>我是 Plugin_1.miki()
</span></span><span style="display:block;padding:0 1.25rem">我是 Plugin_2.miki()
</span><span style="display:block;padding:0 1.25rem">[3, -1]</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">可以通过 <code>tryfirst</code> 和 <code>trylast</code> 来控制，有同学应该有印象， Pytest hook 里面也是用 <code>tryfirst</code> 和 <code>trylast</code> 控制其 hook 函数执行的先后顺序的，其底层实现是从这里来的。</p>
<p class="my-4 leading-7">正是因为可以随意添加插件以及修改插件的执行顺序，才使得在 Pytest 中我们能灵活的定义一些 hook 函数来实现我们想要的功能，Pytest 以及其三方插件，都是基于此基本逻辑构建起来的。</p>
<p class="my-4 leading-7">这里就简单介绍一下基本原理，想要深入了解的同学点这里 <a href="https://github.com/pytest-dev/pluggy" target="_blank" rel="noopener noreferrer" class="link_a7cea  link_a9ef4 inline-link_f855c">Pluggy</a>。</p><!--/$--></div><div class="rspress-doc-footer"><footer class="mt-8"><div class="xs:flex pb-5 px-2 justify-end items-center"><div class="flex text-sm text-text-2 leading-6 sm:leading-8 font-medium"><p>最近更新时间<!-- -->: <span>2025/6/23 11:34:42</span></p></div></div><div class="flex flex-col"></div><div class="flex flex-col sm:flex-row sm:justify-around gap-4 pt-6"><div class="prev_c92d1 flex flex-col"><a href="/program/index.html" class="link_a7cea pager-link_e0d2d"><span class="desc_dcc01">上一页</span><span class="title_a3acb">章节预览</span></a></div><div class="next_c11be flex flex-col"><a href="/program/autotest/自动化测试框架/unittest—3小时入门版.html" class="link_a7cea pager-link_e0d2d next_ad355"><span class="desc_dcc01">下一页</span><span class="title_a3acb">unittest—3小时入门版</span></a></div></div></footer></div></div><div class="aside-container_bc5fa"><div class="flex flex-col"><div id="aside-container" class="relative text-sm font-medium"><div class="leading-7 block text-sm font-semibold pl-3">本页目录</div><nav class="mt-1"><ul class="relative"><li><a href="#一简介" title="一、简介" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">一、简介</span></a></li><li><a href="#二安装" title="二、安装" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">二、安装</span></a></li><li><a href="#三用例编写" title="三、用例编写" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">三、用例编写</span></a></li><li><a href="#1函数式" title="1、函数式" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">1、函数式</span></a></li><li><a href="#2类式" title="2、类式" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">2、类式</span></a></li><li><a href="#四fixture" title="四、fixture" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">四、fixture</span></a></li><li><a href="#1级别" title="1、级别" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">1、级别</span></a></li><li><a href="#2不同的写法" title="2、不同的写法" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">2、不同的写法</span></a></li><li><a href="#21xunit-的写法" title="2.1、XUnit 的写法" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:24px;font-weight:semibold"><span class="aside-link-text block">2.1、XUnit 的写法</span></a></li><li><a href="#22fixture-写法" title="2.2、fixture 写法" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:24px;font-weight:semibold"><span class="aside-link-text block">2.2、fixture 写法</span></a></li><li><a href="#3共享" title="3、共享" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">3、共享</span></a></li><li><a href="#31用例之间共享" title="3.1、用例之间共享" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:24px;font-weight:semibold"><span class="aside-link-text block">3.1、用例之间共享</span></a></li><li><a href="#32用例类之间共享" title="3.2、用例类之间共享" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:24px;font-weight:semibold"><span class="aside-link-text block">3.2、用例类之间共享</span></a></li><li><a href="#33超级共享" title="3.3、超级共享" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:24px;font-weight:semibold"><span class="aside-link-text block">3.3、超级共享</span></a></li><li><a href="#4顺序" title="4、顺序" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">4、顺序</span></a></li><li><a href="#五断言" title="五、断言" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">五、断言</span></a></li><li><a href="#1常规断言" title="1、常规断言" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">1、常规断言</span></a></li><li><a href="#2自定义断言" title="2、自定义断言" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">2、自定义断言</span></a></li><li><a href="#六命令行参数" title="六、命令行参数" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">六、命令行参数</span></a></li><li><a href="#1-s" title="1、-s" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">1、-s</span></a></li><li><a href="#2-v" title="2、-v" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">2、-v</span></a></li><li><a href="#3-k" title="3、-k" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">3、-k</span></a></li><li><a href="#4-m" title="4、-m" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">4、-m</span></a></li><li><a href="#5--co" title="5、--co" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">5、--co</span></a></li><li><a href="#6maxfail" title="6、maxfail" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">6、maxfail</span></a></li><li><a href="#7reruns" title="7、reruns" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">7、reruns</span></a></li><li><a href="#8timeout" title="8、timeout" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">8、timeout</span></a></li><li><a href="#9自定义命令行参数" title="9、自定义命令行参数" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">9、自定义命令行参数</span></a></li><li><a href="#七参数化" title="七、参数化" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">七、参数化</span></a></li><li><a href="#八hook钩子函数" title="八、Hook（钩子）函数" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">八、Hook（钩子）函数</span></a></li><li><a href="#1hook-函数略览" title="1、hook 函数略览" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">1、hook 函数略览</span></a></li><li><a href="#2常用的-hook-函数" title="2、常用的 hook 函数" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">2、常用的 hook 函数</span></a></li><li><a href="#21pytest_addoption" title="2.1、pytest_addoption" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:24px;font-weight:semibold"><span class="aside-link-text block">2.1、pytest_addoption</span></a></li><li><a href="#22pytest_configure" title="2.2、pytest_configure" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:24px;font-weight:semibold"><span class="aside-link-text block">2.2、pytest_configure</span></a></li><li><a href="#23pytest_sessionstart" title="2.3、pytest_sessionstart" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:24px;font-weight:semibold"><span class="aside-link-text block">2.3、pytest_sessionstart</span></a></li><li><a href="#24pytest_collection_modifyitems" title="2.4、pytest_collection_modifyitems" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:24px;font-weight:semibold"><span class="aside-link-text block">2.4、pytest_collection_modifyitems</span></a></li><li><a href="#25pytest_runtest_setup" title="2.5、pytest_runtest_setup" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:24px;font-weight:semibold"><span class="aside-link-text block">2.5、pytest_runtest_setup</span></a></li><li><a href="#26pytest_runtest_makereport" title="2.6、pytest_runtest_makereport" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:24px;font-weight:semibold"><span class="aside-link-text block">2.6、pytest_runtest_makereport</span></a></li><li><a href="#九测试报告" title="九、测试报告" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">九、测试报告</span></a></li><li><a href="#1allure" title="1、allure" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">1、allure</span></a></li><li><a href="#2pytest-html" title="2、pytest-html" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">2、pytest-html</span></a></li><li><a href="#3xml" title="3、xml" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">3、xml</span></a></li><li><a href="#十pytest-框架核心" title="十、Pytest 框架核心" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">十、Pytest 框架核心</span></a></li></ul></nav></div></div></div></div></div></div></section></div>
    <div id="search-container"></div>
  </body>
</html>
