"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["9102"],{5983:function(e,n,s){s.r(n),s.d(n,{default:()=>d});var t=s(2676),r=s(453);function a(e){let n=Object.assign({h1:"h1",a:"a",h2:"h2",p:"p",code:"code",pre:"pre"},(0,r.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.h1,{id:"控制客户端返回超时问题",children:["控制客户端，返回超时问题",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#控制客户端返回超时问题",children:"#"})]}),"\n",(0,t.jsxs)(n.h2,{id:"现象",children:["现象",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#现象",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["执行需要与加域客户端交互的测试用例，当脚本代码完成发送后，操作客户端时，",(0,t.jsx)(n.code,{children:"zerorpc"}),"通信超时："]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"x86_64-35: 07/31 11:18:27 | DEBUG | connected to tcp://10.8.12.9:4243 (status=<SocketContext(connect='tcp://10.8.12.9:4243')>)\nx86_64-35: 07/31 11:18:27 | DEBUG | --\x3e new channel b'e80b75021e28402186f871ea993c4eb4'\nx86_64-35: 07/31 11:18:30 | DEBUG | -x- closed channel b'e80b75021e28402186f871ea993c4eb4'\nx86_64-35: 07/31 11:18:30 | DEBUG | [sleep]: sleep 5 s [x86_64 * 1.0 = 5.0]\nx86_64-35: 07/31 11:18:35 | INFO  | [sleep]: sleep 2 s [x86_64 * 1.0 = 2.0]\nWarning: Permanently added '10.8.12.9' (ECDSA) to the list of known hosts.\nsending incremental file list\nautotest_udcp/_readme/README.md\nautotest_udcp/case/pages/logs/logs_pc/test_logs_1340913.py\nautotest_udcp/client/widget/base_widget.py\nautotest_udcp/client/widget/udcp_wizzard_widget.py\n\nsent 20,068 bytes  received 243 bytes  40,622.00 bytes/sec\ntotal size is 781,136,071  speedup is 38,458.77\nx86_64-35: 07/31 11:18:38 | DEBUG | connected to tcp://10.8.12.9:4243 (status=<SocketContext(connect='tcp://10.8.12.9:4243')>)\nx86_64-35: 07/31 11:18:38 | DEBUG | --\x3e new channel b'e80b75031e28402186f871ea993c4eb4'\nx86_64-35: 07/31 11:18:58 | DEBUG | -x- closed channel b'e80b75031e28402186f871ea993c4eb4'\nx86_64-35: 07/31 11:18:58 | INFO  | [pytest_runtest_makereport]: 运行结果: FAILED\n【 2024-07-31 11:18:58.619927 TestUdcp.test_client_cts_1450161 || FAILED ✘ 】\n\napps/autotest_udcp/case/pages/client_cts/test_client_cts_1450161.py:14 (TestUdcp.test_client_cts_1450161)\nself = <zerorpc.channel.BufferedChannel object at 0x7feb61978160>, timeout = 20\n\n    def recv(self, timeout=None):\n        # self._channel can be set to None by an 'on_close_if' callback if it\n        # sees a suitable message from the remote end...\n        #\n        if self._verbose and self._channel:\n            if self._input_queue_reserved < self._input_queue_size // 2:\n                self._request_data()\n        else:\n            self._verbose = True\n    \n        try:\n>           event = self._input_queue.get(timeout=timeout)\n\n/home/lxs-pen/.local/lib/python3.7/site-packages/zerorpc/channel.py:255: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n>   ???\n\nsrc/gevent/queue.py:335: \n\n……\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"分析",children:["分析",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#分析",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["1、进入加域客户端，手动启动远程服务，提示",(0,t.jsx)(n.code,{children:"Could not open X display"}),"："]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"(youqu) 12345@uos-PC:~/youqu/src/remotectl$ python3 _remote_other_ctl.py \nNo protocol specified\nUnable to init server: Could not connect: Connection refused\nNo protocol specified\nUnable to init server: 无法连接：Connection refused\nNo protocol specified\n\n(_remote_other_ctl.py:21887): dbind-WARNING **: 10:00:10.002: Could not open X display\n\n"})}),"\n",(0,t.jsx)(n.p,{children:"2、查看当前登录终端，发现有多个 x 服务在运行："}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ $ who\nuos      tty1         2024-07-30 16:50 (:0)\n12345    tty2         2024-07-30 17:04 (:1)\n12345    pts/0        2024-07-31 09:59 (10.8.11.74)\n\n"})}),"\n",(0,t.jsx)(n.p,{children:"3、注销 x 服务为 0 的用户，再次尝试依旧复现，查询后发现加域账户依旧虽然为第一个 x 服务，但是标识依旧是 :1"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ $ who\n12345    tty2         2024-07-30 17:04 (:1)\n12345    pts/0        2024-07-31 09:59 (10.8.11.74)\n\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"解决",children:["解决",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#解决",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"重启终端系统，只登录加域账户，问题消失"}),"\n",(0,t.jsx)(n.h1,{id:"",children:(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#",children:"#"})}),"\n",(0,t.jsxs)(n.h1,{id:"控制客户端无法找到资源问题",children:["控制客户端，无法找到资源问题",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#控制客户端无法找到资源问题",children:"#"})]}),"\n",(0,t.jsxs)(n.h2,{id:"现象-1",children:["现象",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#现象-1",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"执行用例时，服务端网页自动化执行正常，进行客户端断言时，找不到资源（图片资源）"}),"\n",(0,t.jsxs)(n.h2,{id:"分析-1",children:["分析",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#分析-1",children:"#"})]}),"\n",(0,t.jsxs)(n.p,{children:["1、找不到资源，查看客户端 ",(0,t.jsx)(n.code,{children:"youqu"})," 项目的自动化应用项目是否存在对应资源，发现整个 ",(0,t.jsx)(n.code,{children:"youqu"})," 项目没有同步到客户端"]}),"\n",(0,t.jsxs)(n.p,{children:["2、执行前有进行过手动删除 ",(0,t.jsx)(n.code,{children:"youqu"})," 的动作，重新执行时，调试发现没有进行重新发送"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"# youqu/src/remotectl/_base.py\ndef _transfer_appname(ip, password, user, transfer_appname):\n    os.system(\n        f\"sshpass -p '{password}' rsync -av -e ssh --exclude='__pycache__' \"\n        f\"{conf.APPS_PATH}/{transfer_appname} {user}@{ip}:~/{client_project_path}/apps/\"\n    )\n"})}),"\n",(0,t.jsx)(n.p,{children:"3、继续断点调试，发现逻辑为如果存在远端远程服务进程，则不进行文件同步"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"# youqu/src/remotectl/_base.py\ndef check_rpc_started(filename):\n			……\n            _base_env_check()\n            if transfer_appname:\n                _transfer_appname(ip, password, user, transfer_appname)\n            tool_status = os.popen(\n                f'''{_ssh(ip, password, user)} \"ps -aux |  grep {filename} | grep -v grep\"'''\n            ).read()\n            if not tool_status:\n                _transfer_to_client(ip, password, user)\n                _start_client_service(ip, password, user, filename)\n            if restart_service:\n                _restart_client_service(ip, password, user, filename)\n            res = func(*args, **kwargs)\n			……\n"})}),"\n",(0,t.jsx)(n.p,{children:"4、查看客户端服务进程，文件虽然不存在，但是进程依旧存在"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"12345@uos-PC:~$ ps aux|grep remote\n12345     4648  0.5  2.2 725052 183048 ?       SLsl 10:03   0:14 /home/12345@udcp/youqu/.venv/bin/python _remote_other_ctl.py\n12345     5123  0.0  1.9 700436 155644 ?       SLsl 10:03   0:02 /home/12345@udcp/youqu/.venv/bin/python _remote_dogtail_ctl.py\n12345    18070  0.0  0.0  13820   888 pts/1    S+   10:52   0:00 grep remote\n\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"解决-1",children:["解决",(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#解决-1",children:"#"})]}),"\n",(0,t.jsx)(n.p,{children:"杀掉原进程，重新执行，报错消失"})]})}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,r.ah)(),e.components);return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}let d=c;c.__RSPRESS_PAGE_META={},c.__RSPRESS_PAGE_META["blog%2F2024%2F%E5%9F%9F%E7%AE%A1%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%A7%E8%A1%8C%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98.md"]={toc:[{text:"现象",id:"现象",depth:2},{text:"分析",id:"分析",depth:2},{text:"解决",id:"解决",depth:2},{text:"现象",id:"现象-1",depth:2},{text:"分析",id:"分析-1",depth:2},{text:"解决",id:"解决-1",depth:2}],title:"控制客户端，无法找到资源问题",headingTitle:"控制客户端，无法找到资源问题",frontmatter:{Author:"禄烨"}}}}]);