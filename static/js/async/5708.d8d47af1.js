"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["5708"],{1872:function(e,n,s){s.r(n),s.d(n,{default:()=>d});var c=s(2676),a=s(453);function r(e){let n=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",pre:"pre",code:"code",h3:"h3"},(0,a.ah)(),e.components);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.h1,{id:"mmdetection-入门基础",children:["MMDetection 入门基础",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#mmdetection-入门基础",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"MMDetection 是商汤科技开源的一个深度学习框架，国内目标检测领域的翘楚；"}),"\n",(0,c.jsx)(n.p,{children:"相比于 Facebook 开源的 Detectron 框架，作者声称 MMDetection 有三点优势：performance 稍高、训练速度稍快、所需显存稍小。"}),"\n",(0,c.jsx)(n.p,{children:"低调哈，基操，皆坐，勿6，又被他装到了～"}),"\n",(0,c.jsxs)(n.p,{children:["Github地址：",(0,c.jsx)(n.a,{href:"https://github.com/open-mmlab/mmdetection",target:"_blank",rel:"noopener noreferrer",children:"https://github.com/open-mmlab/mmdetection"})]}),"\n",(0,c.jsxs)(n.h2,{id:"一虚拟环境安装",children:["一、虚拟环境安装",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#一虚拟环境安装",children:"#"})]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"cd ~\nwget -c https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh\nbash Miniconda3-latest-Linux-x86_64.sh\n"})}),"\n",(0,c.jsx)(n.p,{children:"一路回车"}),"\n",(0,c.jsxs)(n.p,{children:["第一次提示输入  yes/no ：输入  ",(0,c.jsx)(n.code,{children:"yes"})]}),"\n",(0,c.jsx)(n.p,{children:"继续一路回车"}),"\n",(0,c.jsxs)(n.p,{children:["第二次提示：输入  ",(0,c.jsx)(n.code,{children:"no"})]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"cd ~/miniconda3/bin\nsudo chmod 777 activate\n"})}),"\n",(0,c.jsx)(n.p,{children:"激活conda环境"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:". ./activate\n"})}),"\n",(0,c.jsx)(n.p,{children:"添加公司内网源"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"conda config --add channels bioconda\nconda config --add channels conda-forge\n"})}),"\n",(0,c.jsx)(n.p,{children:"如果是外网添加外网源"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/bioconda/\n"})}),"\n",(0,c.jsx)(n.p,{children:"如果要删除源"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"conda config --remove-key channels\n"})}),"\n",(0,c.jsxs)(n.h2,{id:"二安装依赖",children:["二、安装依赖",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#二安装依赖",children:"#"})]}),"\n",(0,c.jsxs)(n.h3,{id:"1创建虚拟环境",children:["1、创建虚拟环境",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1创建虚拟环境",children:"#"})]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"conda remove --name mmlab --all # 移除所有虚拟环境\n"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"conda create -n mmlab python=3.7\n"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"conda activate mmlab\n"})}),"\n",(0,c.jsxs)(n.h3,{id:"2安装-pytorch",children:["2、安装 Pytorch",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2安装-pytorch",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"在mmlab虚拟环境中执行"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"pip install torch==1.7.0+cu101 torchvision==0.8.1+cu101 torchaudio==0.7.0 -f https://download.pytorch.org/whl/torch_stable.html -i http://pypi.douban.com/simple --trusted-host pypi.douban.com\n"})}),"\n",(0,c.jsxs)(n.h3,{id:"3安装-mmcv",children:["3、安装 MMCV",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3安装-mmcv",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"在mmlab虚拟环境中执行"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"pip install mmcv-full==1.3.3 -f https://download.openmmlab.com/mmcv/dist/cu101/torch1.7.0/index.html -i http://pypi.douban.com/simple --trusted-host pypi.douban.com\n"})}),"\n",(0,c.jsxs)(n.h2,{id:"三数据标注",children:["三、数据标注",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#三数据标注",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"标注之前需要先转换图片大小，并且以数字命名，每组命名递增"}),"\n",(0,c.jsxs)(n.h3,{id:"1转换大小并重命名",children:["1、转换大小并重命名",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1转换大小并重命名",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"rename_pic.py"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:"import os\nimport sys\nimport cv2\nimport time\nimport getpass\nusername = getpass.getuser()\n\nsource_path = f\"/home/{username}/Desktop/right_menu\" # 图片路径\n\nsource_dest = os.path.join('/'.join(source_path.split(\"/\")[:-1]), 'tmp')\nif not os.path.exists(source_dest):\n    os.mkdir(source_dest)\n\nstart_name = sys.argv[1]\n\nfile_name_list = list()\nfor file in os.listdir(source_path):\n    if file.endswith('.png'):\n        file_name_list.append(file)\nstart_name = int(start_name)\nfor file in file_name_list:\n    os.rename(os.path.join(source_path,file), os.path.join(source_path, f\"{str(start_name)}.png\"))\n    start_name += 1\n\ntime.sleep(1)\n\nfor file in os.listdir(source_path):\n    image = os.path.join(source_path, str(file))\n    src = cv2.imread(image)\n    result = cv2.resize(src, (960, 540))\n    resizeImage = os.path.join(source_dest, str(file))\n    print(resizeImage)\n    cv2.imwrite(str(resizeImage), result)\ncv2.waitKey(0)\ncv2.destroyAllWindows()\n\ntime.sleep(1)\n\nos.system(f'rm -rf {source_path}/*')\nos.system(f'mv {source_dest}/* {source_path}')\nos.system(f'rm -rf {source_dest}')\n\nprint(\"下一个序号：\", start_name)\n"})}),"\n",(0,c.jsx)(n.p,{children:"根据终端输出的下一个序号的提示，执行 Python 文件的时候传参。"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"python rename_pic.py 249\n"})}),"\n",(0,c.jsxs)(n.h3,{id:"2工具标注",children:["2、工具标注",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2工具标注",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"使用工具 labelImg 标注"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"sudo pip3 install PyQt5==5.13\nsudo pip3 install labelImg\n"})}),"\n",(0,c.jsx)(n.p,{children:"终端直接输入 labelImg，回车"}),"\n",(0,c.jsxs)(n.p,{children:["标注模式选择：",(0,c.jsx)(n.code,{children:"PascalVOC"})]}),"\n",(0,c.jsxs)(n.h2,{id:"四拉取-mmdetection-代码",children:["四、拉取 MMDetection 代码",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#四拉取-mmdetection-代码",children:"#"})]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"cd ~/Documents\ngit clone https://github.com/open-mmlab/mmdetection.git\n# 不能直接拉取主分支，建议使用2.12版本，不同的版本对应的mmcv版本是不同的\n"})}),"\n",(0,c.jsxs)(n.h2,{id:"五拉取-voc2coco-代码",children:["五、拉取 voc2coco 代码",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#五拉取-voc2coco-代码",children:"#"})]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"cd ~/Documents\ngit clone https://github.com/Tony607/voc2coco.git\n"})}),"\n",(0,c.jsxs)(n.h2,{id:"六转换-coco-数据集",children:["六、转换 coco 数据集",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#六转换-coco-数据集",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"将所有的图片和xml文件放入train2017，从中挑选几组放入val2017（测试集）"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"cd mmdetection/data/coco\npython voc2coco.py train2017 annotations/instances_train2017.json\npython voc2coco.py val2017 annotations/instances_val2017.json\n"})}),"\n",(0,c.jsx)(n.p,{children:"生成json文件"}),"\n",(0,c.jsxs)(n.h2,{id:"七修改配置",children:["七、修改配置",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#七修改配置",children:"#"})]}),"\n",(0,c.jsxs)(n.h3,{id:"1读取模型名称",children:["1、读取模型名称",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1读取模型名称",children:"#"})]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:"import json\n\nmodule_name = []\nwith open('./instances_train2017.json', \"r+\") as f:\n    json_file = f.read()\njson_dict = json.loads(json_file)\nmodule_list = json_dict.get('categories')\nfor module_info in module_list:\n    name = module_info.get('name')\n    module_name.append(name)\nprint(module_name)\nprint(\"module_num:\", len(module_name))\n"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"# 注意对比instances_train2017.json里面模型名称的顺序，与CLASSES和coco_classes里面的顺序保持一致。\n"})}),"\n",(0,c.jsxs)(n.h3,{id:"2修改-faster_rcnn_r101_2x_cocopy",children:["2、修改 faster_rcnn_r101_2x_coco.py",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2修改-faster_rcnn_r101_2x_cocopy",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"mmdetection/xianjin/faster_rcnn_r101_2x_coco.py"})}),"\n",(0,c.jsxs)(n.p,{children:["修改46行，",(0,c.jsx)(n.code,{children:"num_clasess"}),"的指，新增1个，就+1"]}),"\n",(0,c.jsxs)(n.h3,{id:"3修改-cocopy",children:["3、修改 coco.py",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3修改-cocopy",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"mmdetection/mmdet/datasets/coco.py"})}),"\n",(0,c.jsx)(n.p,{children:"CLASSES = ()，在里面添加模型名称"}),"\n",(0,c.jsxs)(n.h3,{id:"4修改-class_namespy",children:["4、修改 class_names.py",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#4修改-class_namespy",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"mmdetection/mmdet/core/evaluation/class_names.py"})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"coco_classes"})," 里面添加模型名称"]}),"\n",(0,c.jsxs)(n.h2,{id:"八缓存清理",children:["八、缓存清理",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#八缓存清理",children:"#"})]}),"\n",(0,c.jsx)(n.p,{children:"删除 mmdetection/build 目录"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-python",children:"python setup.py install\n"})}),"\n",(0,c.jsxs)(n.h2,{id:"九训练模型",children:["九、训练模型",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#九训练模型",children:"#"})]}),"\n",(0,c.jsxs)(n.h3,{id:"指定自己配置的训练模型",children:["指定自己配置的训练模型",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#指定自己配置的训练模型",children:"#"})]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"python tools/train.py xianjin/faster_rcnn_r101_fpn_2x_coco.py --gpus 1\n"})}),"\n",(0,c.jsxs)(n.h3,{id:"查看训练结果的测试集结果",children:["查看训练结果的测试集结果",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#查看训练结果的测试集结果",children:"#"})]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"python tools/train.py xianjin/faster_rcnn_r101_fpn_2x_coco.py xianjin/epoch_24.pth --show\n"})}),"\n",(0,c.jsxs)(n.h3,{id:"查看训练结果的准确度",children:["查看训练结果的准确度",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#查看训练结果的准确度",children:"#"})]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"python tools/analysis_tools/analyze_logs.py plot_curve xianjin/20210530_011907.log.json --keys acc\n"})}),"\n",(0,c.jsxs)(n.h2,{id:"十快捷操作",children:["十、快捷操作",(0,c.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#十快捷操作",children:"#"})]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"python run.py\n"})}),"\n",(0,c.jsx)(n.p,{children:"run.py 整合了以上所有的操作。"})]})}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,a.ah)(),e.components);return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(r,{...e})}):r(e)}let d=i;i.__RSPRESS_PAGE_META={},i.__RSPRESS_PAGE_META["program%2FPython%2FMMDetection%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80.md"]={toc:[{text:"一、虚拟环境安装",id:"一虚拟环境安装",depth:2},{text:"二、安装依赖",id:"二安装依赖",depth:2},{text:"1、创建虚拟环境",id:"1创建虚拟环境",depth:3},{text:"2、安装 Pytorch",id:"2安装-pytorch",depth:3},{text:"3、安装 MMCV",id:"3安装-mmcv",depth:3},{text:"三、数据标注",id:"三数据标注",depth:2},{text:"1、转换大小并重命名",id:"1转换大小并重命名",depth:3},{text:"2、工具标注",id:"2工具标注",depth:3},{text:"四、拉取 MMDetection 代码",id:"四拉取-mmdetection-代码",depth:2},{text:"五、拉取 voc2coco 代码",id:"五拉取-voc2coco-代码",depth:2},{text:"六、转换 coco 数据集",id:"六转换-coco-数据集",depth:2},{text:"七、修改配置",id:"七修改配置",depth:2},{text:"1、读取模型名称",id:"1读取模型名称",depth:3},{text:"2、修改 faster_rcnn_r101_2x_coco.py",id:"2修改-faster_rcnn_r101_2x_cocopy",depth:3},{text:"3、修改 coco.py",id:"3修改-cocopy",depth:3},{text:"4、修改 class_names.py",id:"4修改-class_namespy",depth:3},{text:"八、缓存清理",id:"八缓存清理",depth:2},{text:"九、训练模型",id:"九训练模型",depth:2},{text:"指定自己配置的训练模型",id:"指定自己配置的训练模型",depth:3},{text:"查看训练结果的测试集结果",id:"查看训练结果的测试集结果",depth:3},{text:"查看训练结果的准确度",id:"查看训练结果的准确度",depth:3},{text:"十、快捷操作",id:"十快捷操作",depth:2}],title:"MMDetection 入门基础",headingTitle:"MMDetection 入门基础",frontmatter:{Author:"mikigo"}}}}]);