"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["4252"],{9919:function(n,e,s){s.r(e),s.d(e,{default:()=>d});var r=s(2676),i=s(453);function c(n){let e=Object.assign({h1:"h1",a:"a",h2:"h2",p:"p",code:"code",pre:"pre",hr:"hr",ul:"ul",li:"li",h3:"h3",h4:"h4",em:"em"},(0,i.ah)(),n.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(e.h1,{id:"shell编码规范错误参考手册",children:["Shell编码规范错误参考手册",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#shell编码规范错误参考手册",children:"#"})]}),"\n",(0,r.jsxs)(e.h2,{id:"背景",children:["背景",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#背景",children:"#"})]}),"\n",(0,r.jsxs)(e.p,{children:["Shell 脚本提交以前必须用静态代码扫描工具 ",(0,r.jsx)(e.code,{children:"shellcheck"})," 扫描，根据提示修改代码，需达到扫描后无报错即可通过。"]}),"\n",(0,r.jsx)(e.p,{children:"修改过程中整理了一些常见错误与解决办法以供参考。"}),"\n",(0,r.jsxs)(e.h2,{id:"工具使用",children:["工具使用",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#工具使用",children:"#"})]}),"\n",(0,r.jsxs)(e.p,{children:["安装 ",(0,r.jsx)(e.code,{children:"shellcheck"})," 并使用命令进行扫描，具体步骤如下："]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# 安装：\nsudo apt install shellcheck\n# 扫描：\nshellcheck  -x -s bash *.sh\n# -s 指定使用 bash\n# -x 给予shellcheck跟踪文件的权限，例如一个文件中导入了其他文件\n"})}),"\n",(0,r.jsxs)(e.h2,{id:"错误编号",children:["错误编号",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#错误编号",children:"#"})]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"shellcheck"})," 扫描出的每一个错误，均有其编号，以 ",(0,r.jsx)(e.code,{children:"SC+4位数字"})," 组成，google 可搜索到详细建议，以下为整理出的部分编号，分为两部分："]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["可选修改编号：部分场景下为正常现象，该错误无需修改，在文件头",(0,r.jsx)(e.code,{children:"配置跳过该检测项"}),"与",(0,r.jsx)(e.code,{children:"说明"}),"即可，配置命令 ",(0,r.jsx)(e.code,{children:"#  shellcheck disbale=编号"})]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"必须修改编号：必须修改的错误"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h3,{id:"可选修改编号",children:["可选修改编号：",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#可选修改编号",children:"#"})]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.h4,{id:"sc2154",children:["SC2154",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2154",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"报错：SC2154: quiet_type is referenced but not assigned."}),"\n",(0,r.jsxs)(e.li,{children:["原因：代码中使用的变量",(0,r.jsx)(e.code,{children:"quiet_type"}),"被引用，但并未被赋值"]}),"\n",(0,r.jsx)(e.li,{children:"解决：在引用变量前对齐赋值"}),"\n",(0,r.jsxs)(e.li,{children:["特殊情况：应该测试框架加载了多个文件，文件中存在关联关系，当前文件未被赋值的变量是在其他文件中处理的，顾此时可以特殊处理，跳过该项检查，文件头注释：",(0,r.jsx)(e.code,{children:"# shellcheck disable=SC2154"})]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2034",children:["SC2034",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2034",children:"#"})]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'if [ "$1" = "true" ] && [ "$2" = "true" ]\nthen \n	r="pass"\nelse \n	r="fail"\nfi\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2034: r appears unused. Verify use (or export if used externally)."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"原因：变量ｒ赋值后未被使用，因该文件是存放公共方法，顾变量ｒ在脚本中不会被使用"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["解决：在此文件跳过该项检查，文件头增加注释：",(0,r.jsx)(e.code,{children:"# shellcheck disbale=SC2034"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h3,{id:"必须修改编号",children:["必须修改编号：",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#必须修改编号",children:"#"})]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.h4,{id:"sc2162",children:["SC2162",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2162",children:"#"})]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'read -t 8 -p "${tailor_11}""\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"报错：SC2162:read without -r will mangle backslashes."}),"\n",(0,r.jsx)(e.li,{children:"原因：默认情况下，Read将解释空格和换行符之前的反斜杠，通常您只想读取数据，这就是read -r所做的。除非有充分的理由不使用-r，否则应该始终使用-r（请注意，read-r仍然会去掉前导空格和尾随空格。IFS=“”read-r可防止这种情况。）"}),"\n",(0,r.jsx)(e.li,{children:"修改："}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'read -r -t 8 -p "${tailor_11}""\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"例子："}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"read name\n# 输入：\\n z\n# 输出：n z\n\nread -r name\n# 输入：\\n z\n# 输出：\\n z\n"})}),"\n",(0,r.jsxs)(e.h4,{id:"sc2181",children:["SC2181",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2181",children:"#"})]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'apt install -y iso-tailor\nif [ "$?" == "0" ]; then\n...\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"报错：SC2181:Check exit code directly with e.g. 'if mycmd;', not indirectly with $?."}),"\n",(0,r.jsxs)(e.li,{children:["原因：检查退出代码直接使用 ",(0,r.jsx)(e.code,{children:"if mycmd;"})," ，而不是使用$?"]}),"\n",(0,r.jsx)(e.li,{children:"修改："}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"\nif apt install -y iso-tailor; then\n...\n"})}),"\n",(0,r.jsxs)(e.h4,{id:"sc1090",children:["SC1090",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc1090",children:"#"})]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'source "${PWD}/method/config.sh"\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"报错：SC1090: Can't follow non-constant source. Use a directive to specify location."}),"\n",(0,r.jsxs)(e.li,{children:["原因：",(0,r.jsx)(e.code,{children:"source"}),"后不要跟变量"]}),"\n",(0,r.jsx)(e.li,{children:"修改："}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'source "method/config.sh"\n'})}),"\n",(0,r.jsxs)(e.h4,{id:"sc1091",children:["SC1091",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc1091",children:"#"})]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"source method/config\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC1091: Not following: method/config was not specified as input (see shellcheck -x)."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["原因：file not found, no permissions, not included on the command line, not allowing ",(0,r.jsx)(e.code,{children:"shellcheck"})," to follow files with ",(0,r.jsx)(e.code,{children:"-x"})]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["命令行输出检查命令时加上参数",(0,r.jsx)(e.code,{children:"-x"}),"，允许 shellcheck 跟踪文件：shellcheck -x -s bash test.sh"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"注意：当涉及文件无权限时，使用之后方法"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["文件中错误命令上增加注释",(0,r.jsx)(e.code,{children:"# shellcheck disable=SC1091"}),"，跳过该错误项检查："]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"# 方法1验证有效\n# 注意：一般在对涉及文件无权限时，使用此方法\n# shellcheck disable=SC1091\nsource method/assertion.sh\n\n# 方法2验证无效（why？）\n# 注意：一般在对涉及文件有权限时，使用此方法\n# shellcheck source=method/assertion.sh\nsource method/assertion.sh\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2219",children:["SC2219",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2219",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2219: Instead of 'let expr', prefer (( expr )) ."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["原因：使用",(0,r.jsx)(e.code,{children:"((  ))"})," 代替 ",(0,r.jsx)(e.code,{children:"let"})]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"# 修改前\nlet a+=1 \n\n# 修改后\n(( a+=1 ))\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2076",children:["SC2076",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2076",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2076: Don't quote rhs of =~, it'll match literally rather than as a regex."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["原因：使用",(0,r.jsx)(e.code,{children:"=~"})," 但右侧的值存在",(0,r.jsx)(e.code,{children:'" "'}),"，那将按照字面量匹配，而非正则表达式"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:'# 修改前\nif [[ "${2}" =~ "${1}" ]]\n\n# 修改方案1，不使用" "，但该场景是使用传入的值，无法控制，推荐使用方案2\n# 备注：若=~右侧非变量，去掉" "即可，若有空格可使用\'\\\'\nif [[ "${2}" =~ ${1} ]]\n\n# 修改方案2，不使用 \'=~\'\nif [[ "${2}" == *"${1}"* ]]\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2010",children:["SC2010",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2010",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2010: Don't use ls | grep. Use a glob or a for loop with a condition to allow non-alphanumeric filenames."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"原因：不要使用 ls|grep，可使用 glob 通配符"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:'#修改前\niso="$(ls ${PWD}/resource/test_iso/ | grep iso)"\n\n#修改后\niso="$(ls ${PWD}/resource/test_iso/*iso*)"\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2046",children:["SC2046",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2046",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：Double quote to prevent globbing and word splitting."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"原因：当命令扩展未加引号时，将发生单词拆分和全局合并。当文件名包含空格时，这通常表现为中断。"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# 修改前\nif [ $(command -v startdde) ];then\n	os_type="gui"\nelse\n	os_type="cli"\nfi\n\n#修改后\nif [ "$(command -v startdde)" ];then\n	os_type="gui"\nelse\n	os_type="cli"\nfi\n'})}),"\n",(0,r.jsxs)(e.h4,{id:"sc2086",children:["SC2086",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2086",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：Double quote to prevent globbing and word splitting."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"原因：引用变量可防止单词拆分和全局扩展，并在输入包含空格、换行符、全局字符等时防止脚本中断。"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:'# 修改前\nls ${PWD}/.file\n\n#修改后\nls "${PWD}/.file"\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2188",children:["SC2188",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2188",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2188: This redirection doesn't have a command. Move to its command (or use 'true' as no-op)."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"原因：重定向无命令"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"# 修改前\n> ${error_log_path}\n\n# 修改后\ntrue > ${error_log_path}\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2013",children:["SC2013",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2013",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2013: To read lines rather than words, pipe/redirect to a 'while read' loop."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["原因：要读取行，而不是词时，使用管道/重定向到",(0,r.jsx)(e.code,{children:"while read"}),"循环"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:'# 修改前\nfor case_files in $(cat ${PWD}/.file/iso_case_list.log);do\n	source ${PWD}/case/iso_case/Round_${case_files}.sh\ndone\n\n# 修改后\nwhile read -r line || [[ -n $line ]]; do\n	source "${PWD}/case/iso_case/Round_${line}.sh"\ndone < "${PWD}/.file/iso_case_list.log"\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2129",children:["SC2129",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2129",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2129:Consider using { cmd1; cmd2; } >> file instead of individual redirects."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"原因：多个重定向时，建议使用{ cmd1; cmd2; } >> file，更为简洁"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"# Problematic code:\n\necho foo >> file\ndate >> file\ncat stuff  >> file\n\n# ------------------------\n\n# Correct code:\n\n{\n  echo foo\n  date\n  cat stuff\n} >> fil\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"SC2126"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["报错：SC2126:Consider using ",(0,r.jsx)(e.code,{children:"grep -c"})," instead of ",(0,r.jsx)(e.code,{children:"grep | wc"})]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"原因：grep+wc时，可使用grep -c代替"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:'# Problematic code:\ngrep "${com}" "${error_log_path}" | wc -l\n\n\n# Correct code:\ngrep -c "${com}" "${error_log_path}"\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2230",children:["SC2230",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2230",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2230:which is non-standard. Use builtin 'command -v' instead."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["原因：which是在PATH中定位可执行文件的非标准外部工具。command -v是一个POSIX标准内置命令，它使用与shell本身相同的查找机制，使用",(0,r.jsx)(e.code,{children:"command -v"}),"代替",(0,r.jsx)(e.code,{children:"which"})]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"# Problematic code:\nwhich wc\n\n\n# Correct code:\ncommand -v wc\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2002",children:["SC2002",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2002",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2002:Useless cat. Consider 'cmd < file | ..' or 'cmd file | ..' instead."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["原因：",(0,r.jsx)(e.code,{children:"CAT"}),"是启用文件的工具。将单个文件作为程序的输入读取被认为是对Cat(UUOC)的无用使用。简单地使用重定向更高效、更少迂回。对于可以从可查找的输入中获益的程序(如Tail或tar)，情况尤其如此。"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"# Problematic code:\ncat file | grep iso\ncat file | wc -l\n\n# Correct code:\ngrep iso file\nwc -l < file\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2164",children:["SC2164",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2164",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2164:Use cd ... || exit in case cd fails."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["原因：",(0,r.jsx)(e.code,{children:"CAT"}),"是启用文件的工具。将单个文件作为程序的输入读取被认为是对Cat(UUOC)的无用使用。简单地使用重定向更高效、更少迂回。对于可以从可查找的输入中获益的程序(如Tail或tar)，情况尤其如此。"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"# Problematic code:\ncd generated_files\nrm -r *.c\n\nfunc(){\n  cd foo\n  do_something\n}\n\n\n# Correct code:\ncd generated_files || exit\nrm -r *.c\n\nfunc(){\n  cd foo || return\n  do_something\n}\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2145",children:["SC2145",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2145",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2145:Argument mixes string and array. Use * or separate argument."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"原因：参数混合了字符串和数组。使用*或单独的参数。"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:'#Problematic code:\nprintf "Error: %s\\n" "Bad parameters: $@"\n#Correct code:\nprintf "Error: %s\\n" "Bad parameters: $*"\n\n#Problematic code 2:\nprintf "Error: %s\\n" "Bad parameters: ${ARRAY_VAR[@]}"\n#Correct code 2:\nprintf "Error: %s\\n" "Bad parameters: " "${ARRAY_VAR[@]}"\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2185",children:["SC2185",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2185",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2185:Some finds don't have a default path. Specify '.' explicitly."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"原因：如果没有提供搜索路径，GNU和Busybox find将使用当前目录的默认路径。在POSIX、MacOS/OSX、FreeBSD、OpenBSD和NetBSD上，它反而会导致错误。"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"#Problematic code:\nfind |grep test_b_logo\n\n#Correct code:\nfind . |grep test_b_logo\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2012",children:["SC2012",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2012",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["报错：SC2012:Use ",(0,r.jsx)(e.code,{children:"find"})," instead of ",(0,r.jsx)(e.code,{children:"ls"})," to better handle non-alphanumeric filenames."]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"原因：如果您想要的仅仅是文件名或它们的数量，那么ls通常可以替换为find。"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"#Problematic code:\nls case/iso_case/Round*\n\n#Correct code:\nfind case/iso_case/Round*\n\n\n# 注意：\n# find输出具有找到的文件的完整路径，相对于运行find的当前工作目录，而ls只有文件名。\n# 所以如果只是项获取文件名，在ls替换find的时候需要做额外的处理\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2143",children:["SC2143",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2143",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2143:Use grep -q instead of comparing output with [ -n .. ]."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"原因：grep判断结果时，使用grep -q，而不是将结果输出，正确的代码更干净，并在第一个匹配行停止，避免了迭代目录的其余部分和将数据读入内存。"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:'#Problematic code:\nif [ "$(find . | grep \'IMG[0-9]\')" ]\nthen\n  echo "Images found"\nfi\n\n#Correct code:\nif find . | grep -q \'IMG[0-9]\'\nthen\n  echo "Images found"\nfi\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2001",children:["SC2001",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2001",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2001: See if you can use ${variable//search/replace} instead."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"原因：echo 变量+sed处理输出时，壳尝试使用${variable//search/replace}"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:'#Problematic code:\nstring="stirng" ; echo "$string" | sed -e "s/ir/ri/"\n\n#Correct code:\nstring="stirng" ; echo "${string//ir/ri}"\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2116",children:["SC2116",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2116",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2116: Useless echo? Instead of 'cmd $(echo foo)', just use 'cmd foo'."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"原因：无用的echo"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:'#Problematic code:\ngreeting=$(echo "Hello, $name")\n# or\ntar czf "$(echo "$(date +%F).tar.gz")" *\n\n#Correct code:\ngreeting="Hello, $name"\n# or\ntar czf "$(date +%F).tar.gz" *\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2059",children:["SC2059",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2059",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:'报错：Don\'t use variables in the printf format string. Use printf "..%s.." "$foo".'}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["原因：",(0,r.jsx)(e.code,{children:"printf"}),"未使用",(0,r.jsx)(e.code,{children:"%s"})]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:'#Problematic code:\nprintf "Hello, $NAME\\n"\n\n#Correct code:\nprintf "Hello, %s\\n" "$NAME"\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2066",children:["SC2066",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2066",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2066: Since you double quoted this, it will not word split, and the loop will only run once."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:'原因：for循环使用了数组："array[*]"，由于使用了双引号，因此不会拆分单词，循环只会运行一次。'}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:'#Problematic code:\nfor i in "${test_user_id[*]}";do\n\n#Correct code:\nfor i in ${test_user_id[*]};do\nfor i in "${test_user_id[@]}";do\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2103",children:["SC2103",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2103",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2103: Use a ( subshell ) to avoid having to cd back.."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"原因：使用子shell执行命令，避免回放cd。"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:'# Problematic code:\n\nfor dir in */\ndo\n  cd "$dir"\n  convert index.png index.jpg\n  cd ..\ndone\n\n# Correct code:\n\nfor dir in */\ndo\n  (\n  cd "$dir" || exit\n  convert index.png index.jpg\n  )\ndone\n\n# or\n\nfor dir in */\ndo\n  cd "$dir" || exit\n  convert index.png index.jpg\n  cd ..\ndone\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2035",children:["SC2035",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2035",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["报错：SC2103: Use ./",(0,r.jsx)(e.em,{children:"glob"})," or -- ",(0,r.jsx)(e.em,{children:"glob"})," so names with dashes won't become options."]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["原因：因为文件和参数是以相同方式传递的字符串，所以程序不能正确地识别，使用",(0,r.jsx)(e.code,{children:"./"}),"、",(0,r.jsx)(e.code,{children:"--"}),"可避免这个问题。"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"# Problematic code:\n\nrm *\n\n# Correct code:\n\nrm ./*\n\n# or\n\nrm -- *\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2124",children:["SC2124",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2124",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2124: Assigning an array to a string! Assign as array, or use * instead of @ to concatenate."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"原因：将数组赋给字符串！赋值为数组，或使用*而不是@进行连接。"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:'# Problematic code:\nxx() {\n\n	test="${@}"\n\n}\n\n# Correct code:\n\nxx() {\n\n	test="${*}"\n\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc1012",children:["SC1012",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc1012",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["报错：SC1012: ",(0,r.jsx)(e.code,{children:"\\t"})," is just literal ",(0,r.jsx)(e.code,{children:"t"})," here. For tab, use ",(0,r.jsx)(e.code,{children:"\"$(printf '\\t')\""})," instead."]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["原因：ShellCheck 发现了一个",(0,r.jsx)(e.code,{children:"\\t"}),",",(0,r.jsx)(e.code,{children:"\\n"}),"或者",(0,r.jsx)(e.code,{children:"\\r"}),"在一个上下文中，它们只是变成了普通的字母",(0,r.jsx)(e.code,{children:"t"}),"，",(0,r.jsx)(e.code,{children:"n"}),"或者",(0,r.jsx)(e.code,{children:"r"}),"。很可能，它被用作制表符、换行符或回车符。"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:'# Problematic code:\n# Want tab\nvar=foo\\tbar\n# Want linefeed\nvar=foo\\nbar\n\n# Correct code:\nvar="foo$(printf \'\\t\')bar"  # As suggested in warning\nvar="$(printf \'foo\\tbar\')"  # Equivalent alternative\n\n# Literal, quoted linefeed\nline="foo\nbar"\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2048",children:["SC2048",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2048",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:'报错：SC2048: Use "$@" (with quotes) to prevent whitespace problems.'}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["原因：当一个数组使用 ",(0,r.jsx)(e.code,{children:"for"})," 循环遍历时，相对于 ",(0,r.jsx)(e.code,{children:"$*"})," ， ",(0,r.jsx)(e.code,{children:'"$@"'})," 要更为安全，避免空格可引起的其他问题。"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:'# Problematic code:\nfor i in ${user_list[*]}; do\n    if test -s "${sat_path}/method/users/process_${i}.sh"; then\n    "os_env_check_${i}"\n    fi\ndone\n\n# Correct code:\nfor i in "${user_list[@]}"; do\n    if test -s "${sat_path}/method/users/process_${i}.sh"; then\n    "os_env_check_${i}"\n    fi\ndone\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.h4,{id:"sc2268",children:["SC2268",(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#sc2268",children:"#"})]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"报错：SC2268 (style): Avoid x-prefix in comparisons as it no longer serves a purpose."}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"原因：避免在比较中使用x-prefix，因为它不再起作用。"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"解决："}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:'# Problematic code:\n[ "x$pass" = "xswordfish" ]\ntest x"$var" = x \n\n# Correct code:\n[ "$pass" = "swordfish" ] \ntest "$var" = ""\n'})}),"\n"]}),"\n"]})]})}function l(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,i.ah)(),n.components);return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(c,{...n})}):c(n)}let d=l;l.__RSPRESS_PAGE_META={},l.__RSPRESS_PAGE_META["program%2FShell%2FShell%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E9%94%99%E8%AF%AF%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C.md"]={toc:[{text:"背景",id:"背景",depth:2},{text:"工具使用",id:"工具使用",depth:2},{text:"错误编号",id:"错误编号",depth:2},{text:"可选修改编号：",id:"可选修改编号",depth:3},{text:"SC2154",id:"sc2154",depth:4},{text:"SC2034",id:"sc2034",depth:4},{text:"必须修改编号：",id:"必须修改编号",depth:3},{text:"SC2162",id:"sc2162",depth:4},{text:"SC2181",id:"sc2181",depth:4},{text:"SC1090",id:"sc1090",depth:4},{text:"SC1091",id:"sc1091",depth:4},{text:"SC2219",id:"sc2219",depth:4},{text:"SC2076",id:"sc2076",depth:4},{text:"SC2010",id:"sc2010",depth:4},{text:"SC2046",id:"sc2046",depth:4},{text:"SC2086",id:"sc2086",depth:4},{text:"SC2188",id:"sc2188",depth:4},{text:"SC2013",id:"sc2013",depth:4},{text:"SC2129",id:"sc2129",depth:4},{text:"SC2230",id:"sc2230",depth:4},{text:"SC2002",id:"sc2002",depth:4},{text:"SC2164",id:"sc2164",depth:4},{text:"SC2145",id:"sc2145",depth:4},{text:"SC2185",id:"sc2185",depth:4},{text:"SC2012",id:"sc2012",depth:4},{text:"SC2143",id:"sc2143",depth:4},{text:"SC2001",id:"sc2001",depth:4},{text:"SC2116",id:"sc2116",depth:4},{text:"SC2059",id:"sc2059",depth:4},{text:"SC2066",id:"sc2066",depth:4},{text:"SC2103",id:"sc2103",depth:4},{text:"SC2035",id:"sc2035",depth:4},{text:"SC2124",id:"sc2124",depth:4},{text:"SC1012",id:"sc1012",depth:4},{text:"SC2048",id:"sc2048",depth:4},{text:"SC2268",id:"sc2268",depth:4}],title:"Shell编码规范错误参考手册",headingTitle:"Shell编码规范错误参考手册",frontmatter:{Author:"海针"}}}}]);