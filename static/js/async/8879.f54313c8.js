"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["8879"],{7981:function(e,n,s){s.r(n),s.d(n,{default:()=>l});var i=s(2676),c=s(453);function d(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",pre:"pre",code:"code",h2:"h2",h3:"h3",h4:"h4",ul:"ul",li:"li",strong:"strong"},(0,c.ah)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.h1,{id:"智能化性能测试",children:["智能化性能测试",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#智能化性能测试",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://pic.imgdb.cn/item/64f054c7661c6c8e54ff4be0.png",alt:""})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# =============================================\n# Attribution ：Chengdu Test Team\n# Time        : 2023/1/3\n# =============================================\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"一简述",children:["一、简述",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#一简述",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"智能化性能测试"}),"\n",(0,i.jsx)(n.p,{children:"通过自动化手段对应用进行性能测试，提供方便的环境部署、运行配置、用例编写等，用于桌面应用的冷热启动、资源拷贝、页面跳转等性能场景测试。"}),"\n",(0,i.jsxs)(n.p,{children:["仓库地址：",(0,i.jsx)(n.a,{href:"https://gerrit.uniontech.com/admin/repos/autotest-perf-aitest",target:"_blank",rel:"noopener noreferrer",children:(0,i.jsx)(n.a,{href:"https://gerrit.uniontech.com/admin/repos/autotest-perf-aitest",target:"_blank",rel:"noopener noreferrer",children:"https://gerrit.uniontech.com/admin/repos/autotest-perf-aitest"})})]}),"\n",(0,i.jsxs)(n.h2,{id:"二代码结构",children:["二、代码结构",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#二代码结构",children:"#"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"autotest-perf-aitest\n├── apps					# 存放所有应用性能测试脚本\n├── conftest.py				# pytest hook相关方法\n├── CURRENT					# 版本内容\n├── docs					# 文档\n│\xa0\xa0 ├── 键值对照表.pdf		 # 串口线code与按键的对照\n│\xa0\xa0 ├── 性能自动化测试脚本执行器使用指南.md		# 执行器脚本使用指南\n│\xa0\xa0 ├── USB串口转USB键盘鼠标线协议文件V1.0.pdf		# 串口协议\n│\xa0\xa0 └── xserver-xorg-input-libinput-0.28.2.zip	# Linux下绝对坐标操作依赖的源码，可根据架构打包\n├── manage.py	# 功能主入口\n├── pytest.ini	# pytst 配置\n├── README.md\n├── setting		# 设置\n│\xa0\xa0 ├── client.ini	# 测试机 IP 设置\n│\xa0\xa0 ├── config.py	# 全局配置\n│\xa0\xa0 ├── dev_env.sh	# 宿主机环境部署脚本\n│\xa0\xa0 ├── docker-compose_no_relay.yml	# 无继电器容器集群\n│\xa0\xa0 ├── docker-compose.yml		# 有继电器容器集群\n│\xa0\xa0 ├── docker_login.sh		# docker 登陆\n│\xa0\xa0 ├── __init__.py\n│\xa0\xa0 ├── res\n│\xa0\xa0 │\xa0\xa0 ├── black.png		# 全黑图片，用于修改壁纸\n│\xa0\xa0 │\xa0\xa0 ├── xserver-xorg-input-libinput_0.28.2-2_5000.deb		# 3A5000 架构鼠标绝对坐标依赖\n│\xa0\xa0 │\xa0\xa0 ├── xserver-xorg-input-libinput_0.28.2-2_amd64.deb		# amd 架构鼠标绝对坐标依赖\n│\xa0\xa0 │\xa0\xa0 ├── xserver-xorg-input-libinput_0.28.2-2_arm64.deb		# arm 架构鼠标绝对坐标依赖\n│\xa0\xa0 │\xa0\xa0 ├── xserver-xorg-input-libinput_0.28.2-2_mips64.deb		# mips 架构鼠标绝对坐标依赖\n│\xa0\xa0 │\xa0\xa0 └── xserver-xorg-input-libinput_0.28.2-2_sw_64.deb		# sw 架构鼠标绝对坐标依赖\n│\xa0\xa0 ├── server.ini		# 服务器配置\n│\xa0\xa0 ├── setup.sh		# 容器环境部署脚本\n│\xa0\xa0 ├── template		# 创建 app 基础脚本模板\n│\xa0\xa0 │\xa0\xa0 └── app_template\n│\xa0\xa0 │\xa0\xa0     ├── ${app_name}_widget.py-tpl\n│\xa0\xa0 │\xa0\xa0     ├── control-tpl\n│\xa0\xa0 │\xa0\xa0     ├── images\n│\xa0\xa0 │\xa0\xa0     │\xa0\xa0 └── readme\n│\xa0\xa0 │\xa0\xa0     ├── __init__.py-tpl\n│\xa0\xa0 │\xa0\xa0     ├── test_${app_name}_01_scene.json-tpl\n│\xa0\xa0 │\xa0\xa0     └── test_${app_name}_01_scene.py-tpl\n│\xa0\xa0 └── uos_docker		# 容器环境配置\n│\xa0\xa0     ├── dockerfile\n│\xa0\xa0     └── requirements.txt\n└── src\n    ├── analysis_save.py	# 解析图片流结果，汇总生成 excel 报告\n    ├── base_widget.py		# 封装的基础操作，应用调用的主入口方法\n    ├── cmdctl.py			# 调用命令行使用\n    ├── global_value.py		# 全局变量\n    ├── image_utils.py		# 图片相关方法\n    ├── __init__.py\n    ├── logger_utils.py		# 日志配置\n    ├── pdocr.py			# ocr 配置\n    ├── public_method.py	# 一些方便的封住\n    ├── record.py			# 录屏相关\n    ├── rtk					# 运行相关\n    │\xa0\xa0 ├── _base.py		# 一些枚举\n    │\xa0\xa0 ├── __init__.py\n    │\xa0\xa0 ├── install_env.py	# 安装环境\n    │\xa0\xa0 └── local_runner.py	# 运行用例\n    ├── serial_communication	# 串口相关\n    │\xa0\xa0 ├── __init__.py\n    │\xa0\xa0 ├── power_control.py	# 继电器操作，使用继电器连接主机电源，控制开关机\n    │\xa0\xa0 ├── serial_common.py	# 串口公共方法\n    │\xa0\xa0 └── usb_mk.py			# 键鼠操作基础封装\n    ├── shortcut_key.py			# 快捷键的封装\n    ├── singleton.py			# 单例模式\n    ├── start_app.py			# 创建 app\n    └── write_xlsx.py			# 生成 excel\n\n# __init__.py 文件为标识该目录是一个Python的模块包，项目中的__init__.py均为空文件。\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"三环境搭建",children:["三、环境搭建",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#三环境搭建",children:"#"})]}),"\n",(0,i.jsxs)(n.h3,{id:"1硬件环境",children:["1、硬件环境",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1硬件环境",children:"#"})]}),"\n",(0,i.jsxs)(n.h4,{id:"1设备清单",children:["（1）设备清单",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1设备清单",children:"#"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"测试机至少一台。"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["服务端一台。（仅支持 ",(0,i.jsx)(n.code,{children:"AMD"})," 架构，若需其他架构，咨询相关开发人员）"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["采集盒一个。 （",(0,i.jsx)(n.code,{children:"ACASIS"}),"  ",(0,i.jsx)(n.code,{children:"HDMI"})," 视频采集盒，",(0,i.jsx)(n.a,{href:"https://item.jd.com/100013302599.html#crumb-wrap",target:"_blank",rel:"noopener noreferrer",children:"https://item.jd.com/100013302599.html#crumb-wrap"})," ）"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["USB串口转USB键鼠协议线。（优胜电子科技USB串口转USB键鼠协议线B类，",(0,i.jsx)(n.a,{href:"https://item.taobao.com/item.htm?spm=a1z10.3-c.w4002-1385258877.57.7ea037891D6nKh&id=611894882981",target:"_blank",rel:"noopener noreferrer",children:"https://item.taobao.com/item.htm?spm=a1z10.3-c.w4002-1385258877.57.7ea037891D6nKh&id=611894882981"})," ）"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.h4,{id:"2硬件环境搭建",children:["（2）硬件环境搭建",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2硬件环境搭建",children:"#"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["采集盒，",(0,i.jsx)(n.code,{children:"HDMI"})," 端连接测试机， ",(0,i.jsx)(n.code,{children:"USB"})," 端连接到服务器上。"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"USB"})," 串口线，白色端连接服务器，黑色端连接测试机（",(0,i.jsx)(n.code,{children:"USB3.0"})," 接口上）。"]}),"\n",(0,i.jsxs)(n.li,{children:["如果需要可以接 ",(0,i.jsx)(n.code,{children:"USB"})," 延长线。"]}),"\n",(0,i.jsx)(n.li,{children:"测试机上可以不接显示器。"}),"\n"]}),"\n",(0,i.jsxs)(n.h4,{id:"3服务端推荐配置",children:["（3）服务端推荐配置",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3服务端推荐配置",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"配置越高，解析速度越快。"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"处理器: Intel(R) Core(TM) i3-10100 CPU @ 3.60GHz (四核 / 八逻辑处理器)\n主板: B460-N2(J)\n内存: 8GB(TF32D4U2S1MEH-8 DDR4 3200MHz (0.3ns))\n显示适配器: UHD Graphics 630\n存储设备: FORESEE P900F256GBH (256 GB)/ST1000DM003-1SB102 (1.00 TB)\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"2测试机环境搭建",children:["2、测试机环境搭建",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2测试机环境搭建",children:"#"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"打开控制中心，账户设置为【自动登录】和【无密码登录】，电源管理中使用电源全部设置为【从不】，开启开发者模式。"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"根据应用性能测试要求，导入相关测试资源，比如：导入相册、影院、音乐的测试资源。"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["在服务端打开相机应用后，将测试机桌面壁纸更换为纯色壁纸（注意，服务端需提前开启相机后再设置测试机壁纸，建议纯黑壁纸 ",(0,i.jsx)(n.code,{children:"setting/res/black.png"}),"）"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"在文件管理器中，将选项 主菜单-设置-预览-图片预览 取消勾选（如不取消，会影响截图录屏应用的性能数据）"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"移动或删除系统 Logo ，排除桌面右下角 Logo 的影响（重启生效）。"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"sudo mv /usr/share/deepin/uos_logo.svg ~/Pictures/\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"安装鼠标绝对坐标操作依赖（必须安装！！）"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"AMD"})," 安装  ",(0,i.jsx)(n.code,{children:"setting/res "})," 目录下 ",(0,i.jsx)(n.code,{children:"xserver-xorg-input-libinput_0.28.2-2_amd64.deb"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ARM"})," 安装  ",(0,i.jsx)(n.code,{children:"setting/res "})," 目录下 ",(0,i.jsx)(n.code,{children:"xserver-xorg-input-libinput_0.28.2-2_arm64.deb"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"MIPS"})," 安装  setting/",(0,i.jsx)(n.code,{children:"res "})," 目录下 ",(0,i.jsx)(n.code,{children:"xserver-xorg-input-libinput_0.28.2-2_mips64.deb"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"3A5000"})," 安装  ",(0,i.jsx)(n.code,{children:"setting/res "})," 目录下 ",(0,i.jsx)(n.code,{children:"xserver-xorg-input-libinput_0.28.2-2_5000.deb"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"安装命令"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"sudo dkpg -i xserver-xorg-input-libinput_0.28.2-2_amd64.deb\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"安装时会提示已存在相同版本，请忽略，直接覆盖安装，安装完成后，必须重启主机才生效"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"3服务端一键环境部署",children:["3、服务端一键环境部署",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3服务端一键环境部署",children:"#"})]}),"\n",(0,i.jsxs)(n.p,{children:["环境搭建前必须先连接上 ",(0,i.jsx)(n.code,{children:"USB"})," 串口线和采集盒。"]}),"\n",(0,i.jsx)(n.p,{children:"宿主机环境安装"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"python3 manage.py install --env host\n"})}),"\n",(0,i.jsx)(n.p,{children:"容器环境安装"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"python3 manage.py install --env docker\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"四配置项",children:["四、配置项",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#四配置项",children:"#"})]}),"\n",(0,i.jsxs)(n.h3,{id:"1服务端配置",children:["1、服务端配置",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1服务端配置",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"setting/config/server.ini"})}),"\n",(0,i.jsx)(n.p,{children:"用于配置测试过程中的一些配置项，包含了所有服务端所有的可配置项。"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"本地无网络运行"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["将配置项 ",(0,i.jsx)(n.code,{children:"network=0"})," 即可开始测试。"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"本地有网络运行"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["配置项 ",(0,i.jsx)(n.code,{children:"network=1"})]}),"\n",(0,i.jsxs)(n.li,{children:["(1)配置项 ",(0,i.jsx)(n.code,{children:"client_alias="})," 配置为你要测试的测试机别名，如 ",(0,i.jsx)(n.code,{children:"Alias1"})," 测试机别名在 ",(0,i.jsx)(n.code,{children:"setting/config/client.ini"})," 中进行配置，此时，直接运行 ",(0,i.jsx)(n.code,{children:"python3 manager"})," 即可开始测试。"]}),"\n",(0,i.jsxs)(n.li,{children:["(2)配置项 ",(0,i.jsx)(n.code,{children:"client_alias="})," 为空，测试机别名在 ",(0,i.jsx)(n.code,{children:"config/client.ini"})," 中进行配置，此时，直接运行 ",(0,i.jsx)(n.code,{children:"python3 manager --client_alias Alias1"}),"，即可开始测试。(",(0,i.jsx)(n.code,{children:"Alias1"})," 为你配置的测试机别名)"]}),"\n",(0,i.jsx)(n.li,{children:"(1)和(2)只要使用其一即可。"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["有网络运行，且需要通过 ",(0,i.jsx)(n.code,{children:"Jenkins"})," 上运行一个 ",(0,i.jsx)(n.code,{children:"job"})," ，同时控制多台机器。"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["配置项 ",(0,i.jsx)(n.code,{children:"network=1"})]}),"\n",(0,i.jsxs)(n.li,{children:["配置项 ",(0,i.jsx)(n.code,{children:"client_alias="})," 不用配置，在运行 ",(0,i.jsx)(n.code,{children:"run.sh"})," 的时候直接空格加别名即可，比如：测试机别名为 ",(0,i.jsx)(n.code,{children:"Alias1"})," ，且已经在 ",(0,i.jsx)(n.code,{children:"config/client.ini"})," 中配置了 ",(0,i.jsx)(n.code,{children:"Alias1"})," 的",(0,i.jsx)(n.code,{children:"user"})," ",(0,i.jsx)(n.code,{children:"ip"})," ",(0,i.jsx)(n.code,{children:"password"})," ，则运行 ",(0,i.jsx)(n.code,{children:"bash run.sh Alias1"})," 即可开始测试。"]}),"\n",(0,i.jsxs)(n.li,{children:["在 ",(0,i.jsx)(n.code,{children:"Jenkins"}),"  ",(0,i.jsx)(n.code,{children:"pipeline"})," 里面通过并行 ",(0,i.jsx)(n.code,{children:"stage"})," 或并行调用下层任务的方式可以实现大规模的性能测试需求。"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"详细配置项说明："})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",children:';=============================== CASE CONFIG ===================================\n[case]\n;执行的应用名称\n;为空表示执行 apps/ 目录下所有应用的用例\nAPP_NAME =\n;执行包含关键词的用例\nKEYWORDS =\n;执行包含用例标签的用例\nTAGS =\n;1、KEYWORDS 和 TAGS 都为空表示执行 APP_NAME 的所有用例\n;2、KEYWORDS 和 TAGS 都支持逻辑组合，即 and/or/not 的表达式, e.g. TAGS = L1 or smoke\n\n[case_conf]\n# 尾帧识别的方式stage按阶段划分，ocr通过文案识别，match 图片匹配，ocr文案识别较慢，不推荐使用\nfind_by = stage\n# 最后一个稳定阶段的帧数识别\n# 首帧存在后的第一个大于该配置帧数的阶段的首帧作为性能尾帧\nfinal_stable_num=100\n# 从该帧数开始识别文案或图片，减少分析时间\nstart_num = 150\n# 识别的文案\ntext=\n# 识别图片\nmatch=apps/xxx/images/match.png\n# 识别相似度\nmatch_rate=0.9\n# 用例操作执行之后，停止录屏之前的等待时间，单位秒\n# 比如热启动用例，从点击打开到停止录屏，中间等待5秒；\nduration = 15\n# 单条用例执行的次数\ncount = 5\n# 稳定阶段划分的相似度\nstable_similarity = 0.9997\n\n[server]\n# 调试模式=1，为开启调试模式，0为关闭。\n# 调试模式下默认只执行一次用例，不关机\n# 编写用例的过程中建议开启maintain。\nMAINTAIN = 0\n# 运行的环境docker容器环境，host宿主机环境\nENV = docker\n# 服务端密码\nPASSWORD=1\n# 指定测试机别名\n# 测试机别名在 config/client.ini 中进行配置，比如：\n# [AMD]\n# ip=10.8.15.86\n# user=uos\n# 其中 AMD 为测试机别名，则client_alias=AMD\nCLIENT_ALIAS = x86（Intel-i7）\n# 1 开启网络, 0 关闭网络\n# （1）服务端与测试机须在同一网段下，你可以尝试在服务端通过ssh连接测试机，如果可以连接，说明网络正常。\n# （2）当input_type=FILE_NAME 时，必须开启网络。\nNETWORK = 1\n# 性能结果统计单位 毫秒—ms, 秒—s\nUNIT=ms\n# 测试机开机进入桌面后等待时间,单位/秒\nSTARTUP_DELAY = 60\n# 1为删除缓存，0为不删除缓存\n# 用例执行完后会在report目录下生成智能解析的一些缓存图片。\nCACHE = 0\n# 默认为空，报告会保存在项目下report目录中；\n# 指定报告目录则存放到指定目录。\nREPORT_PATH = report\n# 服务端从测试机获取的icon资源会缓存在项目下input目录中\nINPUT = input/\n# 1为测试完关机，0为测试完不关机\nSHUTDOWN = 0\n# 解析进程数（不推荐修改）\n# 3个进程解析视频已经能够满足，即使增加进程数也不能减少整体耗时\n# 另外还要看CPU核数是否支持。\nPARSING_PROCESS = 3\n# 1为使用继电器开关机，0为使用reboot命令重启。依赖继电器硬件设备，需要使用联系开发者\nRELAY = 0\n# 获取测试应用的版本, %s 占位应用名\n# 如果该配置为空，则不获取应用的版本信息。\nCOMMAND = apt policy %s 2>/dev/null|grep "已安装"|awk -F "：" "{print \\$2}"\n# 关机等待开启时间，单位秒\n# 根据测试机性能不同，开关机耗时可能不同，根据实际测试机情况配置。\nSHUTDOWN_DELAY = 30\n# 可用于图像识别的图片格式，以英文逗号隔开。\n# 该配置项不建议修改，目前我们仅验证了jpg,jpeg,png这三种常用的图片格式。\nINPUT_TYPES = jpg,jpeg,png\n# 性能分析补帧，等于或低于该值的不稳定阶段视为稳定阶段，在最后计算性能结果时需要减掉。\nUN_STAB_START = 3\n# 服务端获取测试机图像的帧率，即每秒获取多少张测试机上的图像。\n# 默认帧率为30帧/秒，该配置项不建议修改，可能会对解析结果造成偏差。\nFPS = 30\n# 以下场景类型会重启测试机,多种场景使用逗号隔开\nSCENE = cold\n;OCR服务端地址（不可随意修改）\nOCR_SERVER_HOST = http://10.8.13.78:8890\n#屏幕图片临时存放位置\nSCREEN_CACHE = /tmp/screen\n\n# =======================================\n[log]\n# 日志级别，OFF、FATAL、ERROR、WARN、INFO、DEBUG、ALL\n# 用例执行过程中的一些日志输出，log_cli=INFO表示 仅输出INFO及以上级别的日志。\nLOG_LEVEL = DEBUG\n# 日志文件保存路径\nLOG_PATH= logs\n\n# =======================================\n[dockerhub]\n# 容器登陆账号\nDOCKER_USER = user\n# 容器登陆密码\nDOCKER_PASSWORD = User1234\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"2测试机配置",children:["2、测试机配置",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2测试机配置",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"setting/config/client.ini"})}),"\n",(0,i.jsx)(n.p,{children:"用于配置测试机的信息。"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["有网络的情况下，服务端需要动态获取测试机上的一些资源，因此你需要写入 ",(0,i.jsx)(n.code,{children:"测试机别名"})," 、 ",(0,i.jsx)(n.code,{children:"user"})," 、",(0,i.jsx)(n.code,{children:"ip"}),"、 ",(0,i.jsx)(n.code,{children:"password"})," 。"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",children:"# 测试机别名\n[Alias1] \n# 测试机ip\nip=10.8.15.86 \n# 测试机用户名\nuser=uos\n"})}),"\n",(0,i.jsxs)(n.p,{children:["命名建议：",(0,i.jsx)(n.code,{children:"AliasA1"}),"、",(0,i.jsx)(n.code,{children:"AliasA2"}),"、",(0,i.jsx)(n.code,{children:"AliasB1"}),"、",(0,i.jsx)(n.code,{children:"AliasB2"}),"，不要重名。"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["无网络情况下，仅需要关注测试机分辨率配置项 ",(0,i.jsx)(n.code,{children:"width="}),"、 ",(0,i.jsx)(n.code,{children:"height="})," 即可。"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"详细配置项说明："})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",children:"[client]\n# 默认测试机用户名，密码，ip\nip=\nuser=\n\n# 测试机密码\npassword=1\n\n# 测试机主题\ntheme=bloom\n\n# 测试机icon目录\npath=/usr/share/icons\n\n# 系统desktop文件的存放目录，UOS系统默认为/usr/share/applications\ndesktop_path=/usr/share/applications\n\n# 用于判断测试机是否开机进入桌面的识别标识。\n# 1、通过桌面图标识别。\n#   - type=FILE_NAME时，服务器和测试机必须在同一局域网内。\n#   - power_on=dde-computer表示通过桌面计算机图标判断开机进入桌面。\n# 2、通过本地图片作为开机识别。\n#   - type= 传入为图片格式，type支持的类型包含在server.ini内配置项input_type=jpg,jpeg,png。\n#   - power_on= 传入的是本地图片的路径。\ntype=FILE_NAME\npower_on=dde-computer\n\n# 测试机分辨率配置（测试机连接采集盒，采集盒的分辨率）\nheight=1080\nwidth=1920\n\n[AliasA1] \nip=10.8.15.86\nuser=uos\n# password=1 如果这里不写密码，默认取上面client里面的password\n\n[AliasA2]\nip=10.8.15.20\nuser=uos\n# password=1 如果这里不写密码，默认取上面client里面的password\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"3场景个性化配置",children:["3、场景个性化配置",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3场景个性化配置",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"随着测试场景的不断引入，发现现有服务端里的配置项并不适用于所有的性能场景，于是将服务端配置进行一个提取，可做单个场景的个性化配置，当然原来的服务端配置功能保留，只是当你配置了场景个性化配置后，优先使用个性化配置里面的内容，以下是对个性化配置的介绍。"}),"\n",(0,i.jsx)(n.p,{children:"目前每一个 py 文件对应一个性能测试场景，于是在同级目录下创建一个与之同名的 json 文件，作为个性化配置文件"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"apps\n├── album\n    ├── test_album_01_start.json  # 个性化配置文件\n    └── test_album_01_start.py  # 性能场景文件\n"})}),"\n",(0,i.jsx)(n.p,{children:"以下是对 json 文件中配置的解释，若某项配置不需要，可以缺失，但不能为空；"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "title": "test_album_start",		# 标题；必须\n  "app_name": "deepin-album",		# 场景所属的应用；必须\n  "scene": "hot",					# 场景别名；必须\n  "icon": ["deepin-album"],			# 这条用例里面需要用到的所有icon，用例执行之前会从测试机上拷贝所有需要用的icon到服务端，用于图像识别。；可缺失\n                                    # 注意：列表中元素为应用desktop文件的文件名，相册的desktop文件名为deepin-album.desktop，\n                                    # 只需要写deepin-album即可，“.desktop”已经在底层做了拼接。\n  "size": {                         # 图片对比的区域设置项，某些应用当前屏幕的部分区域需要将其去掉，可以设置此项，如果没有则可不写；可确实\n    "x-coordinate": 0,				# 左上角横坐标\n    "y-coordinate": 0,				# 左上角纵坐标\n    "width": 850,					# 横向长度\n    "height": 1920					# 纵向高度\n  },\n  "count": 5,						# 场景执行的次数；必须\n  "duration": 5,					# 该条用例操作执行之后，停止录屏之前的等待时间，单位秒，针对于某些特定场景，该配置为可选项，覆盖 server.ini 中的配置；可缺失\n  "stable_similarity": 0.9997,		# 性能场景分阶段时的图片相似度对比，前后图片低于该值，则分为不稳定阶段；可缺失\n  "find_by": "stage",               # 尾帧识别的方式stage按阶段划分，ocr通过文案识别，match 图片匹配\n  "final_stable_num": 100, # 查找最后一个大于该值的稳定阶段的首帧作为性能的尾祯；可缺失\n  "start_num": 150,\n  "text": "",                       # ocr识别的文案\n  "match": "apps/xxx/images/match.png",  # 图像匹配的图片文件路径\n  "match_rate": 0.9                       # 匹配相似度\n}\n'})}),"\n",(0,i.jsxs)(n.h2,{id:"五测试流程",children:["五、测试流程",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#五测试流程",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://pic.imgdb.cn/item/64f054cb661c6c8e54ff5034.png",alt:""})}),"\n",(0,i.jsxs)(n.h2,{id:"六用例编写及方法参数指引",children:["六、用例编写及方法参数指引",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#六用例编写及方法参数指引",children:"#"})]}),"\n",(0,i.jsxs)(n.h3,{id:"1用例实例说明",children:["1、用例实例说明",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1用例实例说明",children:"#"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# 标准库导入\nfrom time import sleep\n# 导入三方库pytest\nimport pytest\n# 导入用例执行要用到的Widget类\nfrom src.base_widget import BaseWidget\n\n\nclass TestStart:\n\n  # class级别的fixture，测试用例执行之前执行。autouse=True 自动在当前作用域下使用。\n  @pytest.fixture(scope="class", autouse=True)\n  # 测试热启动之前需要预启动。\n  def application_pre_start(self):\n    # 入参规则在第2点中详细描述。\n    BaseWidget().right_click_element("deepin-album")\n    # 入参规则在第2点中详细描述。\n    BaseWidget().click_element("apps/autotest_deepin_album/picture/open.png", input_type="png")\n    sleep(2)\n    # 快捷键关闭窗口\n    BaseWidget().hot_key("alt", "f4")\n    sleep(2)\n\n  # 默认为function级别的fixture，用例执行之前，class级别fixture执行之后执行。\n  @pytest.fixture(autouse=True)\n  def setup_start(self):\n    # 右键点击 deepin-album 图标\n    BaseWidget().right_click_element("deepin-album")\n    # 移动到右键菜单中打开（open.png）\n    # 入参规则在第2点中详细描述。\n    BaseWidget().move_to(*BaseWidget().find_element("apps/autotest_deepin_album/picture/open.png", input_type="png"))\n    # 等待移动完成\n    sleep(0.5)\n\n    def test_album_start(self):\n\n    # 点击“打开”\n    BaseWidget().click() \n'})}),"\n",(0,i.jsxs)(n.h3,{id:"2方法参数说明",children:["2、方法参数说明",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2方法参数说明",children:"#"})]}),"\n",(0,i.jsxs)(n.p,{children:["2.1、",(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"find_element"})," 方法"]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'def find_element(element: str, input_type: str = "FILE_NAME", fill_color_position: tuple = (-1, -1), size: tuple = (25, 70)):\n    pass\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["参数 ",(0,i.jsx)(n.code,{children:"element"})," 和 ",(0,i.jsx)(n.code,{children:"input_type"})]})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["（1）通过应用 ",(0,i.jsx)(n.code,{children:"icon"})," 识别元素"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"input_type"})," 参数为默认参数，默认值为 ",(0,i.jsx)(n.code,{children:"FIEL_NAME"})," ，表示通过应用 ",(0,i.jsx)(n.code,{children:"icon"})," 寻找元素，此方法会动态获取测试机上的应用 ",(0,i.jsx)(n.code,{children:"icon"})," 图标。"]}),"\n",(0,i.jsxs)(n.li,{children:["举例：默认情况下 ",(0,i.jsx)(n.code,{children:"input_type "})," 参数不需要传入， ",(0,i.jsx)(n.code,{children:'find_element("deepin-album")'}),"，表示通过 ",(0,i.jsx)(n.code,{children:"deepin-album"})," 的应用 ",(0,i.jsx)(n.code,{children:"icon"})," 来获取坐标，注意，此时传入的 ",(0,i.jsx)(n.code,{children:"deepin-album"})," 参数实际是 ",(0,i.jsx)(n.code,{children:"desktop"}),"文件的文件名，和2.3中的 ",(0,i.jsx)(n.code,{children:"icon"})," 变量一致。"]}),"\n",(0,i.jsx)(n.li,{children:"我们建议优先使用这种方法，但此方法依赖网络，请根据测试环境实际情况选择。"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"（2）通过本地图片识别元素"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["参数 ",(0,i.jsx)(n.code,{children:"input_type"})," 传入图片格式，比如截取的本地图片格式为 ",(0,i.jsx)(n.code,{children:"png"}),"，那么 ",(0,i.jsx)(n.code,{children:'input_type="png"'}),"，此时参数 ",(0,i.jsx)(n.code,{children:"element "})," 传入图片的路径，建议存放在对应的产品  ",(0,i.jsx)(n.code,{children:"apps/app/picture/"})," 目录下，路径为项目根目录下的相对路径。"]}),"\n",(0,i.jsxs)(n.li,{children:["举例：",(0,i.jsx)(n.code,{children:'find_element("apps/autotest_deepin_album/picture/open.png", input_type="png"))'}),"，表示通过本地图片 ",(0,i.jsx)(n.code,{children:"open.png"})," 识别元素。"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["参数 ",(0,i.jsx)(n.code,{children:"fill_color_position"})]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"fill_color_position"})," 参数为默认参数，默认值为 ",(0,i.jsx)(n.code,{children:"(-1, -1)"}),"，",(0,i.jsx)(n.code,{children:"(-1, -1)"})," 表示取屏幕中右下角最后一个像素点作为填充坐标，在  ",(0,i.jsx)(n.code,{children:"1920x1080"})," 屏幕分辨率下即实际坐标为 ",(0,i.jsx)(n.code,{children:"(1919, 1079)"}),"  ，这样的写法可以适配不同大小的屏幕。"]}),"\n",(0,i.jsxs)(n.li,{children:["任务栏在屏幕不同方位：","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"任务栏在屏幕下方，从任务栏启动不需要传入该参数。"}),"\n",(0,i.jsxs)(n.li,{children:["任务栏在屏幕左边，",(0,i.jsx)(n.code,{children:"fill_color_position=(1, 1)"})]}),"\n",(0,i.jsxs)(n.li,{children:["任务栏在屏幕右边，",(0,i.jsx)(n.code,{children:"fill_color_position=(-1, -1)"})]}),"\n",(0,i.jsxs)(n.li,{children:["任务栏在屏幕上边，",(0,i.jsx)(n.code,{children:"fill_color_position=(1, 1)"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"从桌面启动应用，则需要传入除任务栏以外其他位置的坐标，比如(100, 100)，只要这个坐标为除应用和任务栏区域都可以。"}),"\n",(0,i.jsx)(n.li,{children:"从启动器里面启动应用，需要填充的坐标为启动器区域。"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["注：通过应用 ",(0,i.jsx)(n.code,{children:"icon"})," 识别时，从测试机获取的 ",(0,i.jsx)(n.code,{children:"icon"})," 原文件为 ",(0,i.jsx)(n.code,{children:"svg"})," 矢量图，转换为 ",(0,i.jsx)(n.code,{children:"png"})," 之后需要填充边缘透明部分。"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["参数 ",(0,i.jsx)(n.code,{children:"size"})]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"size"})," 参数为默认参数，默认值为 ",(0,i.jsx)(n.code,{children:"(25, 70)"}),"，表示测试机上 ",(0,i.jsx)(n.code,{children:"dock"})," 栏上应用图标的大小范围。"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"UOS"})," 系统 ",(0,i.jsx)(n.code,{children:"dock"})," 栏是可以上下拖动大小的，随着 ",(0,i.jsx)(n.code,{children:"dock"})," 栏大小改变，应用图标的范围为25到70之间。"]}),"\n",(0,i.jsxs)(n.li,{children:["如果你的测试机操作系统上 ",(0,i.jsx)(n.code,{children:"dock"})," 栏大小不一样，可以根据实际情况传入大小范围。"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["2.2、",(0,i.jsx)(n.code,{children:"click_element"}),"、 ",(0,i.jsx)(n.code,{children:"right_click_element"}),"， ",(0,i.jsx)(n.code,{children:"double_click_element"})," 这几个方法参数规则与 ",(0,i.jsx)(n.code,{children:"find_element"})," 方法一样。他们实际上是在  ",(0,i.jsx)(n.code,{children:"find_element"}),"  方法基础之上做了二次封装，增加了鼠标的动作，如果你不想使用这几个方法，在用例中也可以通过  ",(0,i.jsx)(n.code,{children:"find_element"})," 获取到坐标，然后将坐标传入到键鼠的方法中，可以实现同样的效果。"]}),"\n",(0,i.jsxs)(n.p,{children:["2.3、用例类中有个类变量 ",(0,i.jsx)(n.code,{children:'icon = ["deepin-album"] '})," 需要特殊说明，列表中的元素为这条用例里面需要用到的所有 ",(0,i.jsx)(n.code,{children:"icon"}),"，用例执行之前会从测试机上拷贝所有需要用的 ",(0,i.jsx)(n.code,{children:"icon"})," 到服务端用于图像识别。列表中元素为应用 ",(0,i.jsx)(n.code,{children:"desktop"})," 文件的文件名，相册的 ",(0,i.jsx)(n.code,{children:"desktop"})," 文件名为 ",(0,i.jsx)(n.code,{children:"deepin-album.desktop"}),"，只需要写 ",(0,i.jsx)(n.code,{children:"deepin-album"})," 即可，",(0,i.jsx)(n.code,{children:".desktop "})," 已经在底层做了拼接。"]}),"\n",(0,i.jsxs)(n.h2,{id:"七执行入口",children:["七、执行入口",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#七执行入口",children:"#"})]}),"\n",(0,i.jsxs)(n.h3,{id:"1用例组织",children:["1、用例组织",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1用例组织",children:"#"})]}),"\n",(0,i.jsxs)(n.p,{children:["在 ",(0,i.jsx)(n.code,{children:"setting/config/server.ini"})," 文件中 ",(0,i.jsx)(n.code,{children:"APP_NAME= "})," 字段为用例的执行的目录，默认为 ",(0,i.jsx)(n.code,{children:"apps"})," 目录下所有用例。如果你想指定执行某一个应用的用例，你可以将该配置项指定到应用的用例目录，比如：",(0,i.jsx)(n.code,{children:"APP_NAME=deepin_album"}),"， 表示执行相册目录下的用例。"]}),"\n",(0,i.jsxs)(n.h3,{id:"2命令行参数",children:["2、命令行参数",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2命令行参数",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"通过命令行参数配置参数"}),"\n",(0,i.jsxs)(n.p,{children:["以下为 ",(0,i.jsx)(n.code,{children:"python3 manage.py run"})," 提供的一些参数选项："]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"  -a APP, --app APP     应用名称：deepin-music\n  -k KEYWORDS, --keywords KEYWORDS\n                        用例的关键词\n  -t TAGS, --tags TAGS  用例的标签\n  --log_level LOG_LEVEL 日志输出级别\n  --env {host,docker} 在宿主机或容器环境执行\n  --client_alias  选择测试机别名, 可选项为client.ini中已配置, 默认值为 zx-x86.\n  --count 指定用例执行次数\n"})}),"\n",(0,i.jsx)(n.p,{children:"在一些 CI 环境下使用命令行参数会更加方便："}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'python3 manage.py run --app deepin-music --keywords "xxx" --tags "xxx" --env docker\n'})}),"\n",(0,i.jsx)(n.p,{children:"注：在容器中执行时，若强制退出，容器并不会停止运行！"}),"\n",(0,i.jsxs)(n.h2,{id:"八测试报告",children:["八、测试报告",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#八测试报告",children:"#"})]}),"\n",(0,i.jsxs)(n.h3,{id:"1json-报告",children:["1、Json 报告",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1json-报告",children:"#"})]}),"\n",(0,i.jsxs)(n.p,{children:["自研视频解析工具会对单条用例执行一轮生成一个 ",(0,i.jsx)(n.code,{children:"json"})," 文件，存放于 ",(0,i.jsx)(n.code,{children:"report/{app_name}/{scene}/{run_num}"})," 目录下，命名格式为："]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"report.json    \n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"json"})," 内容举例："]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'[\n    {\n        "Stab1": {\n            "images": [1,2...150,151],\n            "startStub": 0,\n            "type": "Stab"\n        }\n    },\n    {\n        "Stab2": {\n            "images": [152,153...169,170],\n            "startStub": 1,\n            "type": "UnStab"\n        }\n    },\n    {\n        "Stab3": {\n            "images": [171,172...300,301],\n            "startStub": 0,\n            "type": "UnStab"\n        }\n    }\n]\n'})}),"\n",(0,i.jsx)(n.p,{children:"说明："}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Stab"})," ：表示解析过程中不同的阶段。"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"images"})," ：表示每一帧的图片序号。"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"startStub"}),"： 为识别尾帧的阶段表示，如果 ",(0,i.jsx)(n.code,{children:'"startStub": 1'})," ，说明尾帧出现在该阶段。"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"type"}),"： 为 ",(0,i.jsx)(n.code,{children:"Stab"})," 或 ",(0,i.jsx)(n.code,{children:"UnStab"})," ，表示稳定阶段或不稳定阶段。"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["各阶段有帧数补偿，默认补偿的帧数为 3 帧（可以通过 ",(0,i.jsx)(n.code,{children:"server.ini"})," 里面 ",(0,i.jsx)(n.code,{children:"un_stab_start=3"})," 进行配置），表示小于等于 3 帧的不稳定阶段视为稳定阶段，在最后计算性能结果时前后均需要减掉。"]}),"\n",(0,i.jsxs)(n.p,{children:["应用启动阶段就是在 ",(0,i.jsx)(n.code,{children:"Stab2"})," 阶段，启动时间为：171 减 151 再减掉前后补偿帧数 6 帧，即 14 帧，视频帧率 30 帧/秒，因此启动耗时为：14 * 33 = 462 ms"]}),"\n",(0,i.jsxs)(n.h3,{id:"2excel-报告",children:["2、Excel 报告",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2excel-报告",children:"#"})]}),"\n",(0,i.jsxs)(n.p,{children:["所有用例执行并解析完之后会 ",(0,i.jsx)(n.code,{children:"report"})," 目录下生成一个汇总数据的 ",(0,i.jsx)(n.code,{children:"Excel"})," 文件，文件名为：",(0,i.jsx)(n.code,{children:"{time}_perf_time.xlsx"}),"。"]}),"\n",(0,i.jsxs)(n.p,{children:["注意，",(0,i.jsx)(n.code,{children:"report"})," 目录为可配置项，默认情况下会在项目根目录下生成，如果你将 ",(0,i.jsx)(n.code,{children:"report"}),"，指定到项目下其他路径，则会在对应的路径下生成 ",(0,i.jsx)(n.code,{children:"json"})," 和 ",(0,i.jsx)(n.code,{children:"Excel"})," 文件。"]}),"\n",(0,i.jsxs)(n.p,{children:["你也可以根据需要读取所有 ",(0,i.jsx)(n.code,{children:"json"})," / ",(0,i.jsx)(n.code,{children:"excel"})," 报告的数据，生成你自己想要的一些测试报告形式。"]}),"\n",(0,i.jsxs)(n.h2,{id:"九usb-串口驱动键鼠方法",children:["九、USB 串口驱动键鼠方法",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#九usb-串口驱动键鼠方法",children:"#"})]}),"\n",(0,i.jsxs)(n.p,{children:["位于 ",(0,i.jsx)(n.code,{children:"src/utils/control/serial_communication"})," 目录下的 ",(0,i.jsx)(n.code,{children:"usb_mk.py"})," 文件"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"usb_mk = UsbMk()\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"1键盘操作",children:["1、键盘操作",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1键盘操作",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"（1）按下键盘按键"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'usb_mk.press_key("enter")   # 按下键盘enter键\n'})}),"\n",(0,i.jsx)(n.p,{children:"（2）按下键盘按键并且不放"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'usb_mk.press_key_down("enter")   # 按下键盘enter键不放\n'})}),"\n",(0,i.jsx)(n.p,{children:"（3）组合按键"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'usb_mk.hot_key("ctrl", "alt", "T")   # 按下组合按键ctrl+alt+T调起终端\n'})}),"\n",(0,i.jsx)(n.p,{children:"（4）组合按键不放"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'usb_mk.hot_key_down("ctrl", "alt", "T")   # 按下组合按键ctrl+alt+T调起终端不放\n'})}),"\n",(0,i.jsx)(n.p,{children:"（5）释放所有键盘按键"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"usb_mk.key_up()\n"})}),"\n",(0,i.jsx)(n.p,{children:"（6）键盘输入字符串（支持传入汉字，会自动转成拼音输入）"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'usb_mk.hot_key("ctrl", "alt", "T")   # 按下组合按键ctrl+alt+T调起终端\nusb_mk.input_text("reboot")   # 输入字符串reboot\nusb_mk.press_key("enter")   # 按下键盘enter键\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"2鼠标操作",children:["2、鼠标操作",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2鼠标操作",children:"#"})]}),"\n",(0,i.jsx)(n.p,{children:"（1）按下鼠标左键"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"usb_mk.click()\n"})}),"\n",(0,i.jsx)(n.p,{children:"（2）按下鼠标左键不放"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"usb_mk.mouse_down() \n"})}),"\n",(0,i.jsx)(n.p,{children:"（3）释放鼠标所有按键"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"usb_mk.mouse_up()  \n"})}),"\n",(0,i.jsx)(n.p,{children:"（4）按下鼠标右键"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"usb_mk.right_click()  \n"})}),"\n",(0,i.jsx)(n.p,{children:"（5）鼠标左键双击"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"usb_mk.double_click() \n"})}),"\n",(0,i.jsx)(n.p,{children:"（6）恢复鼠标至初始位置，默认左上角"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"usb_mk.move_to_init()  \n"})}),"\n",(0,i.jsx)(n.p,{children:"（7）移动鼠标至相对坐标"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"usb_mk.move_rel(100, 200)   # 鼠标向左边移动100个像素，向下移动200个像素\n"})}),"\n",(0,i.jsx)(n.p,{children:"（8）以屏幕左上角为圆心坐标移动鼠标至屏幕绝对坐标"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"usb_mk.move_to(100, 200)   # 鼠标移动至屏幕坐标（100, 200）\n"})}),"\n",(0,i.jsx)(n.p,{children:"（9）按下鼠标左键，拖动到绝对坐标位置"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"usb_mk.drag_to(100, 200)   # 按下鼠标拖动至屏幕坐标（100, 200）\n"})}),"\n",(0,i.jsx)(n.p,{children:"（10）按下鼠标左键，拖动到相对坐标位置"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"usb_mk.drag_rel(100, 200)   # 鼠标向左边移动100个像素，向下移动200个像素\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"十继电器控制主机开机重启",children:["十、继电器控制主机开机/重启",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#十继电器控制主机开机重启",children:"#"})]}),"\n",(0,i.jsxs)(n.p,{children:["（若不使用继电器，可忽略该步骤，执行时会通过命令 ",(0,i.jsx)(n.code,{children:"reboot"}),"）"]}),"\n",(0,i.jsxs)(n.h3,{id:"1继电器设备",children:["1、继电器设备",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1继电器设备",children:"#"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"LCUS-2"})," 型 双路 ",(0,i.jsx)(n.code,{children:"USB"})," 智能串口控制继电器。"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://item.taobao.com/item.htm?spm=a1z09.2.0.0.41d72e8dUYx2pi&id=582653718178&_u=i25r20ia6a2e",target:"_blank",rel:"noopener noreferrer",children:"https://item.taobao.com/item.htm?spm=a1z09.2.0.0.41d72e8dUYx2pi&id=582653718178&_u=i25r20ia6a2e"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://pic.imgdb.cn/item/64f054cb661c6c8e54ff5091.png",alt:""})}),"\n",(0,i.jsxs)(n.h3,{id:"2usb-延长线",children:["2、USB 延长线",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2usb-延长线",children:"#"})]}),"\n",(0,i.jsxs)(n.p,{children:["普通的 ",(0,i.jsx)(n.code,{children:"USB"})," 线即可。"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://pic.imgdb.cn/item/64f054cb661c6c8e54ff50a9.png",alt:""})}),"\n",(0,i.jsxs)(n.h3,{id:"3杜邦线",children:["3、杜邦线",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3杜邦线",children:"#"})]}),"\n",(0,i.jsxs)(n.p,{children:["3.1、",(0,i.jsx)(n.code,{children:"40P"})," 母对公杜邦线。"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://pic.imgdb.cn/item/64f054cb661c6c8e54ff50db.png",alt:""})}),"\n",(0,i.jsx)(n.p,{children:"3.2、一母二公杜邦线。"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://pic.imgdb.cn/item/64f054cb661c6c8e54ff5102.png",alt:""})}),"\n",(0,i.jsxs)(n.h3,{id:"4安装图文教程",children:["4、安装图文教程",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#4安装图文教程",children:"#"})]}),"\n",(0,i.jsxs)(n.p,{children:["4.1、使用 ",(0,i.jsx)(n.code,{children:"USB"})," 延长线连接控制端和继电器。"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://pic.imgdb.cn/item/64f054cb661c6c8e54ff5140.png",alt:""})}),"\n",(0,i.jsx)(n.p,{children:"4.2、在继电器常端和公共端均连接一根杜邦线。"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://pic.imgdb.cn/item/64f054cc661c6c8e54ff5182.png",alt:""})}),"\n",(0,i.jsx)(n.p,{children:"4.3、在主板上开机针和重启针上插上一母二公杜邦线。"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://pic.imgdb.cn/item/64f054cc661c6c8e54ff51c2.png",alt:""})}),"\n",(0,i.jsx)(n.p,{children:"4.4、将开机针外接的一母二公杜邦线的两根公线分别接入继电器的1路继电器（如图 1左侧继电器）和原电源开关。"}),"\n",(0,i.jsx)(n.p,{children:"4.5、将重启针外接的一母二公杜邦线的两根公线分别接入继电器的2路继电器（如图 1 右侧继电器）和原电源开关。"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://pic.imgdb.cn/item/64f054cc661c6c8e54ff523e.png",alt:""})}),"\n",(0,i.jsx)(n.p,{children:"若想保留原电源开关的电源灯，可根据如上图所示，使用杜邦线连接主板上的电源灯和原电源开关"}),"\n",(0,i.jsxs)(n.h2,{id:"十一常见问题说明",children:["十一、常见问题说明",(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#十一常见问题说明",children:"#"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"1、"}),(0,i.jsx)(n.code,{children:'ERROR: for uos  Cannot restart container 2301b1a1395d7959ee6523d61b61c87084649af530786cdb8fb5b3ecbcbd1068: linux runtime spec devices: error gathering device information while adding custom device "/dev/ttyACM0": no such file or directory'})]}),"\n",(0,i.jsxs)(n.p,{children:["检查 USB 串口线连接状态，查看 ",(0,i.jsx)(n.code,{children:"/dev/ttyACM0"})," 是否存在，若存在 ",(0,i.jsx)(n.code,{children:"/dev/ttyACMn"}),"（n为任意数字），重启电脑解决。"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"2、"}),(0,i.jsx)(n.code,{children:"Error response from daemon: Container 5e700fdc769e8c74666d68a7f2bc3de58268b4594cf88706609d59f8dbc7362d is not running"})]}),"\n",(0,i.jsx)(n.p,{children:"容器启动失败"}),"\n",(0,i.jsx)(n.p,{children:"1）检查哪一个容器未启动"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"sudo docker container ls # 列出运行中的 Docker 容器\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://pic.imgdb.cn/item/64f054cc661c6c8e54ff524b.png",alt:""})}),"\n",(0,i.jsx)(n.p,{children:"2）缺少 uos 容器，检查 USB 串口连接线和采集盒连接线是否正常，重启后执行"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"bash install/setup.up # 重新完整部署环境\n"})}),"\n",(0,i.jsx)(n.p,{children:"或执行"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"sudo docker-compose up -d --build	# 仅重新构建 Docker 镜像\n"})}),"\n",(0,i.jsxs)(n.p,{children:["**3、**若部署时提示挂载 ",(0,i.jsx)(n.code,{children:"ttyACM0"}),"、",(0,i.jsx)(n.code,{children:"video0"})," 失败，请检查 USB 串口线及采集盒是否接触良好，若接触良好，重启即可解决。"]}),"\n",(0,i.jsx)(n.p,{children:"4、若出现图片能识别，但是鼠标未移动操作时，安装绝对鼠标操作的依赖包，见第三节第二小节测试机环境搭建，安装完成后，必须重启测试机。"}),"\n",(0,i.jsx)(n.p,{children:"5、由于通过采集卡获取的测试机实时画面，包含了鼠标的样式，所以对图片识别时，鼠标若停留在图标上层，则会对识别结果造成影响，需要将鼠标移动至其他位置，或者隐藏鼠标解决。"}),"\n",(0,i.jsx)(n.p,{children:"6、Excel 报告中，测试场景列与用例中的不一致，关键字scene、app_name、架构别名，不能包含下划线和英文符号的圆括号。"})]})}function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,c.ah)(),e.components);return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}let l=r;r.__RSPRESS_PAGE_META={},r.__RSPRESS_PAGE_META["autotest%2FUI%E8%87%AA%E5%8A%A8%E5%8C%96%2F%E6%99%BA%E8%83%BD%E5%8C%96%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.md"]={toc:[{text:"一、简述",id:"一简述",depth:2},{text:"二、代码结构",id:"二代码结构",depth:2},{text:"三、环境搭建",id:"三环境搭建",depth:2},{text:"1、硬件环境",id:"1硬件环境",depth:3},{text:"（1）设备清单",id:"1设备清单",depth:4},{text:"（2）硬件环境搭建",id:"2硬件环境搭建",depth:4},{text:"（3）服务端推荐配置",id:"3服务端推荐配置",depth:4},{text:"2、测试机环境搭建",id:"2测试机环境搭建",depth:3},{text:"3、服务端一键环境部署",id:"3服务端一键环境部署",depth:3},{text:"四、配置项",id:"四配置项",depth:2},{text:"1、服务端配置",id:"1服务端配置",depth:3},{text:"2、测试机配置",id:"2测试机配置",depth:3},{text:"3、场景个性化配置",id:"3场景个性化配置",depth:3},{text:"五、测试流程",id:"五测试流程",depth:2},{text:"六、用例编写及方法参数指引",id:"六用例编写及方法参数指引",depth:2},{text:"1、用例实例说明",id:"1用例实例说明",depth:3},{text:"2、方法参数说明",id:"2方法参数说明",depth:3},{text:"七、执行入口",id:"七执行入口",depth:2},{text:"1、用例组织",id:"1用例组织",depth:3},{text:"2、命令行参数",id:"2命令行参数",depth:3},{text:"八、测试报告",id:"八测试报告",depth:2},{text:"1、Json 报告",id:"1json-报告",depth:3},{text:"2、Excel 报告",id:"2excel-报告",depth:3},{text:"九、USB 串口驱动键鼠方法",id:"九usb-串口驱动键鼠方法",depth:2},{text:"1、键盘操作",id:"1键盘操作",depth:3},{text:"2、鼠标操作",id:"2鼠标操作",depth:3},{text:"十、继电器控制主机开机/重启",id:"十继电器控制主机开机重启",depth:2},{text:"1、继电器设备",id:"1继电器设备",depth:3},{text:"2、USB 延长线",id:"2usb-延长线",depth:3},{text:"3、杜邦线",id:"3杜邦线",depth:3},{text:"4、安装图文教程",id:"4安装图文教程",depth:3},{text:"十一、常见问题说明",id:"十一常见问题说明",depth:2}],title:"智能化性能测试",headingTitle:"智能化性能测试",frontmatter:{}}}}]);